<?php
/**
 * Plugin Name: AIGen-Replies
 * Plugin URI: 
 * Description: Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª ÙˆÙˆÚ©Ø§Ù…Ø±Ø³ Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ 
 * Version: 1.0.0
 * Author: Mahyar Soltan Mohammadi
 * License: GPL v2 or later
 * Text Domain: AIGen-Replies
 * Requires Plugins: woocommerce
 */
if (!defined('ABSPATH')) {
    exit;
}
class WC_AI_Review_Reply_Pro {
    private $options;
    private $transient_prefix = 'wc_ai_review_';
    private $ai_user_id = 0;
    public function __construct() {
        add_action('plugins_loaded', array($this, 'init'));
        register_activation_hook(__FILE__, array($this, 'activate'));
        register_deactivation_hook(__FILE__, array($this, 'deactivate'));
    }
    public function init() {
        if (!class_exists('WooCommerce')) {
            add_action('admin_notices', array($this, 'woocommerce_missing_notice'));
            return;
        }
        $this->options = get_option('wc_ai_review_settings', array());
        $this->ai_user_id = get_option('wc_ai_review_ai_user_id', 0);
        // Ø§ÙØ²ÙˆØ¯Ù† ÙØ±Ú©Ø§Ù†Ø³ cron Ø¬Ø¯ÛŒØ¯
        add_filter('cron_schedules', array($this, 'add_cron_intervals'));
        // Ù‡ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
        add_action('admin_menu', array($this, 'add_admin_menu'));
        add_action('admin_init', array($this, 'settings_init'));
        add_action('admin_enqueue_scripts', array($this, 'admin_enqueue_scripts'));
        // Ù‡ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ù†Ø¸Ø±Ø§Øª
        add_action('comment_post', array($this, 'handle_comment_submission'), 10, 3);
        add_action('comment_unapproved_to_approved', array($this, 'maybe_auto_reply_on_approval'));
        add_action('wp_set_comment_status', array($this, 'handle_comment_status_change'), 10, 2);
        // Ù‡ÙˆÚ©â€ŒÙ‡Ø§ÛŒ AJAX
        add_action('wp_ajax_generate_ai_reply', array($this, 'generate_ai_reply_ajax'));
        add_action('wp_ajax_test_ai_connection', array($this, 'test_ai_connection_ajax'));
        add_action('wp_ajax_debug_plugin', array($this, 'debug_plugin_ajax'));
        add_action('wp_ajax_get_comment_stats', array($this, 'get_comment_stats_ajax'));
        add_action('wp_ajax_toggle_comment_exception', array($this, 'toggle_comment_exception_ajax'));
        add_action('wp_ajax_complete_ai_task', array($this, 'complete_ai_task_ajax'));
        add_action('wp_ajax_generate_live_preview', array($this, 'generate_live_preview_ajax'));
        add_action('wp_ajax_generate_ai_analysis', array($this, 'generate_ai_analysis_ajax'));
        add_action('wp_ajax_download_analysis_pdf', array($this, 'download_analysis_pdf'));
        // Ø§ÙØ²ÙˆØ¯Ù† cron job Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
        add_action('wc_ai_review_check_scheduled_replies', array($this, 'check_scheduled_replies'));
        // Ù‡ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
        // Ø­Ø°Ù Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø§Ø² Ù„ÛŒØ³Øª Ù†Ø¸Ø±Ø§Øª
        // add_filter('comment_row_actions', array($this, 'add_ai_reply_action'), 10, 2); // Ø­Ø°Ù Ø´Ø¯
        add_action('add_meta_boxes_comment', array($this, 'add_comment_meta_box'));
        add_action('admin_notices', array($this, 'show_admin_notices'));
        // Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØªÙˆØ§
        add_action('save_post', array($this, 'save_post_meta'), 10, 3);
        add_action('add_meta_boxes', array($this, 'add_post_meta_boxes'));
        // ÙÛŒÙ„ØªØ± Ø§Ø³Ù¾Ù…
        add_filter('pre_comment_approved', array($this, 'prevent_duplicate_comments'), 10, 2);
        // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙˆØ±Ø¯Ù¾Ø±Ø³
        add_action('admin_notices', array($this, 'show_human_intervention_alert'));
    }
    public function add_cron_intervals($schedules) {
        $schedules['minute'] = array(
            'interval' => 60, // Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡
            'display' => __('Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡')
        );
        return $schedules;
    }
    public function activate() {
        $this->create_ai_user();
        $default_options = array(
            'api_provider' => 'oneapi',
            'api_key' => '',
            'oneapi_url' => 'https://api.one-api.ir/openai/v1/chat/completions',
            'openai_url' => 'https://api.openai.com/v1/chat/completions',
            'deepseek_url' => 'https://api.deepseek.com/v1/chat/completions',
            'model' => 'gpt-4o-mini',
            'temperature' => '0.7',
            'max_tokens' => '500',
            'auto_reply' => '0',
            'preview_replies' => '1',
            'reply_user' => 'ai', // 'ai' ÛŒØ§ ID Ú©Ø§Ø±Ø¨Ø±
            'custom_prompt' => "Ø´Ù…Ø§ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ø­Ù…Ø§ÛŒØª Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ Ù‡Ø³ØªÛŒØ¯. Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ù‡ ØµÙˆØ±Øª Ù…ÙÛŒØ¯ Ùˆ Ø¬Ø°Ø§Ø¨ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.
Ø²Ø¨Ø§Ù† Ù¾Ø§Ø³Ø®: Ù‡Ù…Ø§Ù† Ø²Ø¨Ø§Ù† Ú©Ø§Ø±Ø¨Ø±
Ù„Ø­Ù†: Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ø¯ÙˆØ³ØªØ§Ù†Ù‡
Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ù…Ø´ØªØ±ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø³Ø§ÛŒØª Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø§ Ø¹Ø°Ø±Ø®ÙˆØ§Ù‡ÛŒ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯ Ú©Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ø¢Ù† Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.
Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„:
Ø¹Ù†ÙˆØ§Ù†: {product_title}
ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ÙˆØªØ§Ù‡: {short_description}
ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ: {attributes}
Ø®Ù„Ø§ØµÙ‡: {description}
Ù†Ø¸Ø± Ù…Ø´ØªØ±ÛŒ:
\"{customer_comment}\"
Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù…Ø¯ÛŒØ± (Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø³Ø¨Ú©):
{previous_replies}
Ø­Ø§Ù„Ø§ ÛŒÚ© Ù¾Ø§Ø³Ø® Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ Ú©Ù‡ Ø¨Ø§ Ø³Ø¨Ú© Ùˆ Ù„Ø­Ù† Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù‡Ù…Ø®ÙˆØ§Ù†ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.",
            'learn_from_previous' => '1',
            'learn_count' => '4',
            'spam_prevention' => '1',
            'spam_action' => 'trash',
            'excluded_categories' => array(),
            'excluded_products' => array(),
            'excluded_post_types' => array(),
            'only_products' => '1',
            'debug_mode' => '0',
            'forbidden_keywords' => '', // <-- Ø¬Ø¯ÛŒØ¯
            'forbidden_response' => 'Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø­Ø§ÙˆÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø¨ÙˆØ¯ Ùˆ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ØªØ´Ø± Ø´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¨Ù‡ Ú©Ø§Ø± Ø¨Ø±Ø¯Ù† Ø²Ø¨Ø§Ù† Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ ÙØ±Ù…Ø§ÛŒÛŒØ¯. Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² Ù‡Ù…Ø±Ø§Ù‡ÛŒ Ø´Ù…Ø§.' // <-- Ø¬Ø¯ÛŒØ¯
        );
        if (false === get_option('wc_ai_review_settings')) {
            add_option('wc_ai_review_settings', $default_options);
        }
        $this->create_log_table();
    }
    public function deactivate() {
        wp_clear_scheduled_hook('wc_ai_review_daily_maintenance');
    }
    public function complete_ai_task_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $task_id = isset($_POST['task_id']) ? sanitize_text_field($_POST['task_id']) : '';
        $tasks = get_option('_wc_ai_review_tasks', array());
        foreach ($tasks as &$task) {
            if ($task['id'] === $task_id) {
                $task['status'] = 'completed';
                break;
            }
        }
        update_option('_wc_ai_review_tasks', $tasks);
        wp_send_json_success();
    }
    public function woocommerce_missing_notice() {
        echo '<div class="error"><p>' . __('WooCommerce AI Review Reply requires WooCommerce to be installed and active.', 'wc-ai-review-reply-pro') . '</p></div>';
    }
    private function create_ai_user() {
        $username = 'ai_assistant';
        $email = 'ai-assistant@' . parse_url(get_site_url(), PHP_URL_HOST);
        if (!username_exists($username) && !email_exists($email)) {
            $user_id = wp_create_user($username, wp_generate_password(), $email);
            if (!is_wp_error($user_id)) {
                $user = new WP_User($user_id);
                $user->set_role('administrator');
                wp_update_user(array(
                    'ID' => $user_id,
                    'display_name' => 'ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ',
                    'first_name' => 'Ù‡ÙˆØ´',
                    'last_name' => 'Ù…ØµÙ†ÙˆØ¹ÛŒ',
                    'description' => 'Ø§Ú©Ø§Ù†Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ'
                ));
                update_option('wc_ai_review_ai_user_id', $user_id);
                $this->ai_user_id = $user_id;
            }
        }
    }
    private function create_log_table() {
        global $wpdb;
        $table_name = $wpdb->prefix . 'wc_ai_review_logs';
        $charset_collate = $wpdb->get_charset_collate();
        $sql = "CREATE TABLE IF NOT EXISTS $table_name (
            id mediumint(9) NOT NULL AUTO_INCREMENT,
            time datetime DEFAULT '0000-00-00 00:00:00' NOT NULL,
            comment_id bigint(20) NOT NULL,
            action varchar(100) NOT NULL,
            message text NOT NULL,
            details text,
            PRIMARY KEY (id)
        ) $charset_collate;";
        require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
        dbDelta($sql);
    }
    private function add_log($comment_id, $action, $message, $details = '') {
        if (!isset($this->options['debug_mode']) || $this->options['debug_mode'] !== '1') {
            return;
        }
        global $wpdb;
        $table_name = $wpdb->prefix . 'wc_ai_review_logs';
        $wpdb->insert(
            $table_name,
            array(
                'time' => current_time('mysql'),
                'comment_id' => $comment_id,
                'action' => $action,
                'message' => $message,
                'details' => is_array($details) ? serialize($details) : $details
            )
        );
    }
    public function add_admin_menu() {
        add_menu_page(
            'Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø¸Ø±Ø§Øª',
            'Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯',
            'manage_options',
            'wc-ai-review-reply',
            array($this, 'admin_dashboard'),
            'dashicons-testimonial',
            56
        );
        add_submenu_page(
            'wc-ai-review-reply',
            'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯',
            'ØªÙ†Ø¸ÛŒÙ…Ø§Øª',
            'manage_options',
            'wc-ai-review-settings',
            array($this, 'settings_page')
        );
        add_submenu_page(
            'wc-ai-review-reply',
            'Ù„Ø§Ú¯ Ùˆ Ø¯ÛŒØ¨Ø§Ú¯',
            'Ø¯ÛŒØ¨Ø§Ú¯',
            'manage_options',
            'wc-ai-review-debug',
            array($this, 'debug_page')
        );
    }
    public function admin_enqueue_scripts($hook) {
        // ÙÙ‚Ø· Ø¯Ø± ØµÙØ­Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾Ù„Ø§Ú¯ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
        $allowed_pages = [
            'edit-comments.php', // ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª
            'comment.php', // ØµÙØ­Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ ØªÚ© Ù†Ø¸Ø±
            'admin_page_wc-ai-review-reply', // Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù¾Ù„Ø§Ú¯ÛŒÙ†
            'admin_page_wc-ai-review-settings', // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            'admin_page_wc-ai-review-debug', // Ø¯ÛŒØ¨Ø§Ú¯
            'admin_page_wc-ai-review-analysis', // ØªØ­Ù„ÛŒÙ„
            'admin_page_wc-ai-review-tasks', // ÙˆØ¸Ø§ÛŒÙ
            'admin_page_wc-ai-review-interested' // Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯
        ];
        if (!in_array($hook, $allowed_pages) && strpos($hook, 'wc-ai-review') === false) {
            return;
        }
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Tailwind CSS Ø§Ø² CDN
        wp_enqueue_style('tailwind-css', 'https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css', array(), '2.2.19');
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ
        wp_enqueue_style('vazirmatn-font', 'https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        wp_enqueue_style('wc-ai-review-admin', plugin_dir_url(__FILE__) . 'admin.css', array(), '3.0.1');
        wp_enqueue_script('wc-ai-review-admin', plugin_dir_url(__FILE__) . 'admin.js', array('jquery'), '3.0.1', true);
        wp_localize_script('wc-ai-review-admin', 'wc_ai_review', array(
            'ajax_url' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('wc_ai_review_nonce'),
            'generating_text' => __('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...', 'wc-ai-review-reply-pro'),
            'generate_text' => __('ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®', 'wc-ai-review-reply-pro'),
            'preview_text' => __('Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®', 'wc-ai-review-reply-pro'),
            'post_text' => __('Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®', 'wc-ai-review-reply-pro'),
            'cancel_text' => __('Ø§Ù†ØµØ±Ø§Ù', 'wc-ai-review-reply-pro'),
            'success_text' => __('Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'wc-ai-review-reply-pro'),
            'error_text' => __('Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†Ø¬Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª', 'wc-ai-review-reply-pro'),
            'confirm_toggle_exception' => __('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ù†Ø¸Ø± Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§ Ø­Ø°Ù/Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.', 'wc-ai-review-reply-pro')
        ));
    }
    public function settings_init() {
        register_setting('wc_ai_review', 'wc_ai_review_settings', array($this, 'sanitize_settings'));
        // Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª API
        add_settings_section(
            'wc_ai_review_api_section',
            __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª API Ùˆ Ù…Ø¯Ù„', 'wc-ai-review-reply-pro'),
            array($this, 'api_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'api_provider',
            __('Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ API', 'wc-ai-review-reply-pro'),
            array($this, 'api_provider_render'),
            'wc_ai_review',
            'wc_ai_review_api_section'
        );
        add_settings_field(
            'api_key',
            __('Ú©Ù„ÛŒØ¯ API', 'wc-ai-review-reply-pro'),
            array($this, 'api_key_render'),
            'wc_ai_review',
            'wc_ai_review_api_section'
        );
        add_settings_field(
            'model',
            __('Ù…Ø¯Ù„', 'wc-ai-review-reply-pro'),
            array($this, 'model_render'),
            'wc_ai_review',
            'wc_ai_review_api_section'
        );
        add_settings_field(
            'temperature',
            __('Ø¯Ù…Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'temperature_render'),
            'wc_ai_review',
            'wc_ai_review_api_section'
        );
        add_settings_field(
            'max_tokens',
            __('Ø­Ø¯Ø§Ú©Ø«Ø± ØªÙˆÚ©Ù†', 'wc-ai-review-reply-pro'),
            array($this, 'max_tokens_render'),
            'wc_ai_review',
            'wc_ai_review_api_section'
        );
        // Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ
        add_settings_section(
            'wc_ai_review_response_section',
            __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'response_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'auto_reply',
            __('Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±', 'wc-ai-review-reply-pro'),
            array($this, 'auto_reply_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        add_settings_field(
            'preview_replies',
            __('Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§', 'wc-ai-review-reply-pro'),
            array($this, 'preview_replies_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        add_settings_field(
            'reply_user',
            __('Ú©Ø§Ø±Ø¨Ø± Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡Ù†Ø¯Ù‡', 'wc-ai-review-reply-pro'),
            array($this, 'reply_user_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        add_settings_field(
            'custom_prompt',
            __('Ù¾Ø±Ø§Ù…Ù¾Øª Ø³ÙØ§Ø±Ø´ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'custom_prompt_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        add_settings_field(
            'learn_from_previous',
            __('ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'learn_from_previous_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        add_settings_field(
            'learn_count',
            __('ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'learn_count_render'),
            'wc_ai_review',
            'wc_ai_review_response_section'
        );
        // Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù¾Ù…
        add_settings_section(
            'wc_ai_review_spam_section',
            __('Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'spam_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'spam_prevention',
            __('Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'spam_prevention_render'),
            'wc_ai_review',
            'wc_ai_review_spam_section'
        );
        add_settings_field(
            'spam_action',
            __('Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'spam_action_render'),
            'wc_ai_review',
            'wc_ai_review_spam_section'
        );
        // Ø¨Ø®Ø´ Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§
        add_settings_section(
            'wc_ai_review_exceptions_section',
            __('Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§', 'wc-ai-review-reply-pro'),
            array($this, 'exceptions_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'only_products',
            __('ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª', 'wc-ai-review-reply-pro'),
            array($this, 'only_products_render'),
            'wc_ai_review',
            'wc_ai_review_exceptions_section'
        );
        add_settings_field(
            'excluded_categories',
            __('Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø³ØªØ«Ù†ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'excluded_categories_render'),
            'wc_ai_review',
            'wc_ai_review_exceptions_section'
        );
        add_settings_field(
            'excluded_products',
            __('Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø³ØªØ«Ù†ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'excluded_products_render'),
            'wc_ai_review',
            'wc_ai_review_exceptions_section'
        );
        add_settings_field(
            'excluded_post_types',
            __('Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø³ØªØ«Ù†ÛŒ', 'wc-ai-review-reply-pro'),
            array($this, 'excluded_post_types_render'),
            'wc_ai_review',
            'wc_ai_review_exceptions_section'
        );
        // Ø¨Ø®Ø´ Ø¯ÛŒØ¨Ø§Ú¯
        add_settings_section(
            'wc_ai_review_debug_section',
            __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯', 'wc-ai-review-reply-pro'),
            array($this, 'debug_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'debug_mode',
            __('Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯', 'wc-ai-review-reply-pro'),
            array($this, 'debug_mode_render'),
            'wc_ai_review',
            'wc_ai_review_debug_section'
        );
        // Ø¨Ø®Ø´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡
        add_settings_section(
            'wc_ai_review_canned_section',
            'Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡',
            array($this, 'canned_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'canned_responses',
            'Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡',
            array($this, 'canned_responses_render'),
            'wc_ai_review',
            'wc_ai_review_canned_section'
        );
        // Ø¨Ø®Ø´ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…Ù…Ù†ÙˆØ¹Ù‡
        add_settings_section(
            'wc_ai_review_keywords_section',
            'Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…Ù…Ù†ÙˆØ¹Ù‡',
            array($this, 'keywords_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'forbidden_keywords',
            'Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡',
            array($this, 'forbidden_keywords_render'),
            'wc_ai_review',
            'wc_ai_review_keywords_section'
        );
        // ÙÛŒÙ„Ø¯ Ø¬Ø¯ÛŒØ¯: Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡
        add_settings_field(
            'forbidden_response',
            'Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡',
            array($this, 'forbidden_response_render'),
            'wc_ai_review',
            'wc_ai_review_keywords_section' // Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø¯Ø± Ù‡Ù…Ø§Ù† Ø¨Ø®Ø´
        );
        // Ø¨Ø®Ø´ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡
        add_settings_section(
            'wc_ai_review_languages_section',
            'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡',
            array($this, 'languages_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'supported_languages',
            'Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡',
            array($this, 'supported_languages_render'),
            'wc_ai_review',
            'wc_ai_review_languages_section'
        );
        add_settings_field(
            'default_language',
            'Ø²Ø¨Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶',
            array($this, 'default_language_render'),
            'wc_ai_review',
            'wc_ai_review_languages_section'
        );
        // Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
        add_settings_section(
            'wc_ai_review_notifications_section',
            'Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ',
            array($this, 'notifications_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'enable_human_intervention_alerts',
            'ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø´Ø¯Ø§Ø± Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ',
            array($this, 'enable_human_intervention_alerts_render'),
            'wc_ai_review',
            'wc_ai_review_notifications_section'
        );
        add_settings_field(
            'human_intervention_response',
            'Ù¾Ø§Ø³Ø® Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ',
            array($this, 'human_intervention_response_render'),
            'wc_ai_review',
            'wc_ai_review_notifications_section'
        );
        // Ø¨Ø®Ø´ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
        add_settings_section(
            'wc_ai_review_scheduling_section',
            'Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§',
            array($this, 'scheduling_section_callback'),
            'wc_ai_review'
        );
        add_settings_field(
            'default_delay',
            'ØªØ§Ø®ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø¯Ù‚ÛŒÙ‚Ù‡)',
            array($this, 'default_delay_render'),
            'wc_ai_review',
            'wc_ai_review_scheduling_section'
        );
        add_settings_field(
            'scheduling_rules',
            'Ù‚ÙˆØ§Ù†ÛŒÙ† Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ',
            array($this, 'scheduling_rules_render'),
            'wc_ai_review',
            'wc_ai_review_scheduling_section'
        );
    }
    // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: Ø³Ù†Ø¬Ø´ Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    public function sanitize_settings($input) {
        $output = array();
        // Ù…ÙˆØ§Ø±Ø¯ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø±Ø´ØªÙ‡ Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆÙ†Ø¯
        $string_fields = array('api_provider', 'api_key', 'model', 'custom_prompt', 'forbidden_keywords', 'forbidden_response', 'human_intervention_response', 'supported_languages', 'default_language');
        foreach ($string_fields as $field) {
            if (isset($input[$field])) {
                $output[$field] = sanitize_text_field($input[$field]);
            }
        }
        // Ù…ÙˆØ§Ø±Ø¯ Ø¹Ø¯Ø¯ÛŒ
        $numeric_fields = array('temperature', 'max_tokens', 'learn_count', 'default_delay');
        foreach ($numeric_fields as $field) {
            if (isset($input[$field])) {
                $output[$field] = floatval($input[$field]);
            }
        }
        // Ù…ÙˆØ§Ø±Ø¯ Ø¨ÙˆÙ„ÛŒÙ† (Ú†Ú© Ø¨Ø§Ú©Ø³)
        $boolean_fields = array('auto_reply', 'preview_replies', 'learn_from_previous', 'spam_prevention', 'only_products', 'debug_mode', 'enable_human_intervention_alerts');
        foreach ($boolean_fields as $field) {
            $output[$field] = isset($input[$field]) ? '1' : '0';
        }
        // Ù…ÙˆØ§Ø±Ø¯ Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ
        $array_fields = array('excluded_categories', 'excluded_products', 'excluded_post_types');
        foreach ($array_fields as $field) {
            if (isset($input[$field]) && is_array($input[$field])) {
                $output[$field] = array_map('intval', $input[$field]);
            } else {
                $output[$field] = array();
            }
        }
        // Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡
        if (isset($input['canned_responses']) && is_array($input['canned_responses'])) {
            $output['canned_responses'] = array();
            foreach ($input['canned_responses'] as $item) {
                if (!empty($item['trigger']) && !empty($item['response'])) {
                    $output['canned_responses'][] = array(
                        'trigger' => sanitize_text_field($item['trigger']),
                        'response' => sanitize_textarea_field($item['response'])
                    );
                }
            }
        }
        // Ù‚ÙˆØ§Ù†ÛŒÙ† Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ
        if (isset($input['scheduling_rules']) && is_array($input['scheduling_rules'])) {
            $output['scheduling_rules'] = array();
            foreach ($input['scheduling_rules'] as $rule) {
                if (!empty($rule['keywords'])) {
                    $output['scheduling_rules'][] = array(
                        'keywords' => sanitize_text_field($rule['keywords']),
                        'delay' => isset($rule['delay']) ? intval($rule['delay']) : 0,
                        'time_range' => isset($rule['time_range']) ? sanitize_text_field($rule['time_range']) : ''
                    );
                }
            }
        }
        // Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ø³Ù¾Ù…
        if (isset($input['spam_action'])) {
            $valid_actions = array('mark_spam', 'trash', 'delete', 'hold');
            $output['spam_action'] = in_array($input['spam_action'], $valid_actions) ? $input['spam_action'] : 'trash';
        }
        // Ú©Ø§Ø±Ø¨Ø± Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡Ù†Ø¯Ù‡
        if (isset($input['reply_user'])) {
            if ($input['reply_user'] === 'ai') {
                $output['reply_user'] = 'ai';
            } else {
                $output['reply_user'] = intval($input['reply_user']);
            }
        }
        return $output;
    }
    public function scheduling_section_callback() {
        echo '<p class="text-sm text-gray-600">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ø±Ø·ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯.</p>';
    }
    public function default_delay_render() {
        $value = isset($this->options['default_delay']) ? intval($this->options['default_delay']) : 60; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 60 Ø¯Ù‚ÛŒÙ‚Ù‡
        ?>
        <input type="number" name="wc_ai_review_settings[default_delay]" value="<?php echo esc_attr($value); ?>" min="0" max="1440" class="block w-full p-2 border border-gray-300 rounded-md" />
        <p class="mt-2 text-xs text-gray-500">ØªØ§Ø®ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® (Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚Ù‡). Ù…Ø«Ù„Ø§Ù‹ 60 = 1 Ø³Ø§Ø¹Øª.</p>
        <?php
    }
    public function scheduling_rules_render() {
        $value = isset($this->options['scheduling_rules']) ? $this->options['scheduling_rules'] : array();
        ?>
        <div id="scheduling-rules-container">
            <?php foreach ($value as $index => $rule): ?>
                <div class="scheduling-rule-item mb-4 p-4 border border-gray-200 rounded-md">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ</label>
                            <input type="text" name="wc_ai_review_settings[scheduling_rules][<?php echo $index; ?>][keywords]" placeholder="Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)" value="<?php echo esc_attr($rule['keywords'] ?? ''); ?>" class="block w-full p-2 border border-gray-300 rounded-md" />
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">ØªØ§Ø®ÛŒØ± (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                            <input type="number" name="wc_ai_review_settings[scheduling_rules][<?php echo $index; ?>][delay]" placeholder="0 Ø¨Ø±Ø§ÛŒ ÙÙˆØ±ÛŒ" value="<?php echo esc_attr($rule['delay'] ?? '0'); ?>" class="block w-full p-2 border border-gray-300 rounded-md" />
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                            <input type="text" name="wc_ai_review_settings[scheduling_rules][<?php echo $index; ?>][time_range]" placeholder="Ù…Ø«Ù„Ø§Ù‹: 09:00-17:00" value="<?php echo esc_attr($rule['time_range'] ?? ''); ?>" class="block w-full p-2 border border-gray-300 rounded-md" />
                        </div>
                    </div>
                    <button type="button" class="remove-scheduling-rule mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded-md">Ø­Ø°Ù Ù‚Ø§Ù†ÙˆÙ†</button>
                </div>
            <?php endforeach; ?>
        </div>
        <button type="button" id="add-scheduling-rule" class="mt-2 px-4 py-2 bg-blue-500 text-white text-sm rounded-md">+ Ø§ÙØ²ÙˆØ¯Ù† Ù‚Ø§Ù†ÙˆÙ† Ø¬Ø¯ÛŒØ¯</button>
        <p class="mt-2 text-xs text-gray-500">
            - Ø§Ú¯Ø± Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø¯Ø± Ù†Ø¸Ø± Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ù‚Ø§Ù†ÙˆÙ† Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
            - ØªØ§Ø®ÛŒØ± 0 Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙÙˆØ±ÛŒ Ø§Ø³Øª.<br>
            - Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³Øª (Ù…Ø«Ù„Ø§Ù‹ 09:00-17:00). Ø§Ú¯Ø± ØªØ¹Ø±ÛŒÙ Ø´ÙˆØ¯ØŒ Ù¾Ø§Ø³Ø® ÙÙ‚Ø· Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </p>
        <script>
            jQuery(document).ready(function($) {
                $('#add-scheduling-rule').on('click', function() {
                    var index = $('#scheduling-rules-container .scheduling-rule-item').length;
                    var html = `
                    <div class="scheduling-rule-item mb-4 p-4 border border-gray-200 rounded-md">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ</label>
                                <input type="text" name="wc_ai_review_settings[scheduling_rules][`+index+`][keywords]" placeholder="Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)" class="block w-full p-2 border border-gray-300 rounded-md" />
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">ØªØ§Ø®ÛŒØ± (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                                <input type="number" name="wc_ai_review_settings[scheduling_rules][`+index+`][delay]" placeholder="0 Ø¨Ø±Ø§ÛŒ ÙÙˆØ±ÛŒ" class="block w-full p-2 border border-gray-300 rounded-md" />
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                                <input type="text" name="wc_ai_review_settings[scheduling_rules][`+index+`][time_range]" placeholder="Ù…Ø«Ù„Ø§Ù‹: 09:00-17:00" class="block w-full p-2 border border-gray-300 rounded-md" />
                            </div>
                        </div>
                        <button type="button" class="remove-scheduling-rule mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded-md">Ø­Ø°Ù Ù‚Ø§Ù†ÙˆÙ†</button>
                    </div>
                `;
                    $('#scheduling-rules-container').append(html);
                });
                $(document).on('click', '.remove-scheduling-rule', function() {
                    $(this).closest('.scheduling-rule-item').remove();
                });
            });
        </script>
        <?php
    }
    // Ø±Ù†Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    public function api_provider_render() {
        $value = isset($this->options['api_provider']) ? $this->options['api_provider'] : 'oneapi';
        ?>
        <select name="wc_ai_review_settings[api_provider]" id="api_provider" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <option value="oneapi" <?php selected($value, 'oneapi'); ?>>OneAPI (ØºÛŒØ±Ø±Ø³Ù…ÛŒØŒ Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù…ØªØ±)</option>
            <option value="openai" <?php selected($value, 'openai'); ?>>OpenAI (Ø±Ø³Ù…ÛŒ)</option>
            <option value="deepseek" <?php selected($value, 'deepseek'); ?>>DeepSeek</option>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('OneAPI ÛŒÚ© API ØºÛŒØ±Ø±Ø³Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ OpenAI Ø¨Ø§ Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù…ØªØ± Ø§Ø³Øª. OpenAI Ùˆ DeepSeek Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø±Ø³Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯.', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function api_key_render() {
        $value = isset($this->options['api_key']) ? $this->options['api_key'] : '';
        ?>
        <input type="password" name="wc_ai_review_settings[api_key]" value="<?php echo esc_attr($value); ?>" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
        <button type="button" id="test-api-connection" class="mt-2 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><?php _e('ØªØ³Øª Ø§ØªØµØ§Ù„', 'wc-ai-review-reply-pro'); ?></button>
        <span id="test-api-result" class="mt-2 block text-sm"></span>
        <?php
    }
    public function model_render() {
        $value = isset($this->options['model']) ? $this->options['model'] : 'gpt-4o-mini';
        ?>
        <input type="text" name="wc_ai_review_settings[model]" value="<?php echo esc_attr($value); ?>" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ù…Ø¯Ù„ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ (Ù…Ø«Ù„Ø§Ù‹: gpt-4o-mini, deepseek-chat)', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function temperature_render() {
        $value = isset($this->options['temperature']) ? $this->options['temperature'] : '0.7';
        ?>
        <input type="number" name="wc_ai_review_settings[temperature]" value="<?php echo esc_attr($value); ?>" min="0" max="1" step="0.1" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ù…ÛŒØ²Ø§Ù† Ø®Ù„Ø§Ù‚ÛŒØª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ (0 = Ú©Ø§Ù…Ù„Ø§Ù‹ deterministicØŒ 1 = Ø¨Ø³ÛŒØ§Ø± Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡)', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function max_tokens_render() {
        $value = isset($this->options['max_tokens']) ? $this->options['max_tokens'] : '500';
        ?>
        <input type="number" name="wc_ai_review_settings[max_tokens]" value="<?php echo esc_attr($value); ?>" min="50" max="2000" step="50" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ø­Ø¯Ø§Ú©Ø«Ø± Ø·ÙˆÙ„ Ù¾Ø§Ø³Ø® ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ (ØªÙˆÚ©Ù†)', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function auto_reply_render() {
        $value = isset($this->options['auto_reply']) ? $this->options['auto_reply'] : '0';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[auto_reply]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <?php
    }
    public function preview_replies_render() {
        $value = isset($this->options['preview_replies']) ? $this->options['preview_replies'] : '1';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[preview_replies]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <?php
    }
    public function reply_user_render() {
        $value = isset($this->options['reply_user']) ? $this->options['reply_user'] : 'ai';
        $users = get_users(array('role__in' => array('administrator', 'shop_manager')));
        ?>
        <select name="wc_ai_review_settings[reply_user]" id="reply_user" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <option value="ai" <?php selected($value, 'ai'); ?>><?php _e('Ú©Ø§Ø±Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ)', 'wc-ai-review-reply-pro'); ?></option>
            <?php foreach ($users as $user): ?>
                <option value="<?php echo $user->ID; ?>" <?php selected($value, $user->ID); ?>><?php echo $user->display_name; ?> (<?php echo $user->user_login; ?>)</option>
            <?php endforeach; ?>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ø¨Ø§ Ù†Ø§Ù… Ø§Ùˆ Ø«Ø¨Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function custom_prompt_render() {
        $value = isset($this->options['custom_prompt']) ? $this->options['custom_prompt'] : '';
        ?>
        <textarea name="wc_ai_review_settings[custom_prompt]" rows="8" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"><?php echo esc_textarea($value); ?></textarea>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ù¾Ø±Ø§Ù…Ù¾Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„. Ø§Ø² Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ {product_title}, {short_description}, {attributes}, {description}, {customer_comment}, {previous_replies} Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function learn_from_previous_render() {
        $value = isset($this->options['learn_from_previous']) ? $this->options['learn_from_previous'] : '1';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[learn_from_previous]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø³Ø¨Ú© Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <?php
    }
    public function check_scheduled_replies() {
        $scheduled_replies = get_option('_wc_ai_review_scheduled_replies', array());
        $current_time = current_time('mysql');
        $updated_replies = array();
        foreach ($scheduled_replies as $reply) {
            if ($reply['status'] === 'pending' && $reply['scheduled_time'] <= $current_time) {
                // ØªÙˆÙ„ÛŒØ¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
                $generated_reply = $this->generate_ai_reply($reply['comment_id']);
                if (!is_wp_error($generated_reply)) {
                    $this->post_reply($reply['comment_id'], $generated_reply);
                    $this->add_log($reply['comment_id'], 'reply_posted_scheduled', 'Ù¾Ø§Ø³Ø® Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
                    // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡
                    $reply['status'] = 'sent';
                } else {
                    $this->add_log($reply['comment_id'], 'reply_failed_scheduled', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡', $generated_reply->get_error_message());
                    // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø¨Ù‡ 'failed' ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
                    $reply['status'] = 'failed';
                }
            }
            // ÙÙ‚Ø· Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯
            if ($reply['status'] === 'pending') {
                $updated_replies[] = $reply;
            }
        }
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
        update_option('_wc_ai_review_scheduled_replies', $updated_replies);
    }
    public function learn_count_render() {
        $value = isset($this->options['learn_count']) ? $this->options['learn_count'] : '4';
        ?>
        <input type="number" name="wc_ai_review_settings[learn_count]" value="<?php echo esc_attr($value); ?>" min="1" max="10" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
        <p class="mt-2 text-sm text-gray-500"><?php _e('ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù…Ø¯ÛŒØ± Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø³Ø¨Ú© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function spam_prevention_render() {
        $value = isset($this->options['spam_prevention']) ? $this->options['spam_prevention'] : '1';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[spam_prevention]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ´Ø®ÛŒØµ Ùˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <?php
    }
    public function spam_action_render() {
        $value = isset($this->options['spam_action']) ? $this->options['spam_action'] : 'trash';
        ?>
        <select name="wc_ai_review_settings[spam_action]" id="spam_action" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <option value="mark_spam" <?php selected($value, 'mark_spam'); ?>><?php _e('Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø³Ù¾Ù…', 'wc-ai-review-reply-pro'); ?></option>
            <option value="trash" <?php selected($value, 'trash'); ?>><?php _e('Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡', 'wc-ai-review-reply-pro'); ?></option>
            <option value="delete" <?php selected($value, 'delete'); ?>><?php _e('Ø­Ø°Ù Ø¯Ø§Ø¦Ù…ÛŒ', 'wc-ai-review-reply-pro'); ?></option>
            <option value="hold" <?php selected($value, 'hold'); ?>><?php _e('Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ', 'wc-ai-review-reply-pro'); ?></option>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function only_products_render() {
        $value = isset($this->options['only_products']) ? $this->options['only_products'] : '1';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[only_products]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª ÙˆÙˆÚ©Ø§Ù…Ø±Ø³', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <?php
    }
    public function excluded_categories_render() {
        $value = isset($this->options['excluded_categories']) ? $this->options['excluded_categories'] : array();
        $categories = get_categories(array('hide_empty' => false, 'taxonomy' => 'product_cat'));
        ?>
        <select name="wc_ai_review_settings[excluded_categories][]" multiple="multiple" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" style="height: 150px;">
            <?php foreach ($categories as $category): ?>
                <option value="<?php echo $category->term_id; ?>" <?php selected(in_array($category->term_id, $value), true); ?>><?php echo $category->name; ?></option>
            <?php endforeach; ?>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù†â€ŒÙ‡Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function excluded_products_render() {
        $value = isset($this->options['excluded_products']) ? $this->options['excluded_products'] : array();
        $products = wc_get_products(array('limit' => -1, 'status' => 'publish'));
        ?>
        <select name="wc_ai_review_settings[excluded_products][]" multiple="multiple" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" style="height: 150px;">
            <?php foreach ($products as $product): ?>
                <option value="<?php echo $product->get_id(); ?>" <?php selected(in_array($product->get_id(), $value), true); ?>><?php echo $product->get_name(); ?></option>
            <?php endforeach; ?>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ù…Ø­ØµÙˆÙ„Ø§ØªÛŒ Ú©Ù‡ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù†â€ŒÙ‡Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function excluded_post_types_render() {
        $value = isset($this->options['excluded_post_types']) ? $this->options['excluded_post_types'] : array();
        $post_types = get_post_types(array('public' => true), 'objects');
        ?>
        <select name="wc_ai_review_settings[excluded_post_types][]" multiple="multiple" class="block w-full mt-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" style="height: 150px;">
            <?php foreach ($post_types as $post_type): ?>
                <option value="<?php echo $post_type->name; ?>" <?php selected(in_array($post_type->name, $value), true); ?>><?php echo $post_type->label; ?></option>
            <?php endforeach; ?>
        </select>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ú©Ù‡ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù†â€ŒÙ‡Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function debug_mode_render() {
        $value = isset($this->options['debug_mode']) ? $this->options['debug_mode'] : '0';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[debug_mode]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2"><?php _e('ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <p class="mt-2 text-sm text-gray-500"><?php _e('Ø¯Ø± Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ØŒ ØªÙ…Ø§Ù…ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ùˆ Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function api_section_callback() {
        echo '<p class="text-sm text-gray-600">' . __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ', 'wc-ai-review-reply-pro') . '</p>';
    }
    public function response_section_callback() {
        echo '<p class="text-sm text-gray-600">' . __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†Ø­ÙˆÙ‡ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª', 'wc-ai-review-reply-pro') . '</p>';
    }
    public function spam_section_callback() {
        echo '<p class="text-sm text-gray-600">' . __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª ØªÚ©Ø±Ø§Ø±ÛŒ Ùˆ Ø§Ø³Ù¾Ù…', 'wc-ai-review-reply-pro') . '</p>';
    }
    public function exceptions_section_callback() {
        echo '<p class="text-sm text-gray-600">' . __('ØªØ¹ÛŒÛŒÙ† Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±', 'wc-ai-review-reply-pro') . '</p>';
    }
    public function debug_section_callback() {
        echo '<p class="text-sm text-gray-600">' . __('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø¯ÛŒØ¨Ø§Ú¯ Ù¾Ù„Ø§Ú¯ÛŒÙ†', 'wc-ai-review-reply-pro') . '</p>';
    }
    public function admin_dashboard() {
        ?>
        <div class="wc-ai-review-dashboard p-6" dir="rtl">
            <!-- Ù‡Ø¯Ø± Ø§ØµÙ„ÛŒ -->
            <div class="flex justify-between items-center mb-8">
                <p class="text-3xl font-bold text-gray-800">Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª ÙˆÙˆÚ©Ø§Ù…Ø±Ø³</p>
                <div class="text-sm text-gray-500">
                    <span>Ù†Ø³Ø®Ù‡: 3.0.1</span>
                </div>
            </div>
            <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ -->
            <div class="bg-blue-50 border-r-4 border-blue-400 p-6 mb-8 rounded-lg">
                <p class="text-xl font-bold text-blue-800 mb-4">ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ù„Ø§Ú¯ÛŒÙ†</p>
                <div class="space-y-4 text-blue-700">
                    <p><strong>1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡:</strong> Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø¨Ø®Ø´ <strong>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</strong> Ø¨Ø±ÙˆÛŒØ¯ Ùˆ Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ OneAPIØŒ OpenAI ÛŒØ§ DeepSeek Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                    <p><strong>2. Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±:</strong> Ø¨Ø§ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡ <strong>"Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±"</strong>ØŒ Ù¾Ù„Ø§Ú¯ÛŒÙ† Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
                    <p><strong>3. Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®:</strong> Ø§Ú¯Ø± Ú¯Ø²ÛŒÙ†Ù‡ <strong>"Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§"</strong> ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ØŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù†Ù‡Ø§ÛŒÛŒØŒ Ù¾Ø§Ø³Ø® ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ ØªØ§ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.</p>
                    <p><strong>4. Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª:</strong> Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ <strong>Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª</strong> ÙˆØ±Ø¯Ù¾Ø±Ø³ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†Ø¸Ø±ØŒ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒØ¯.</p>
                    <p><strong>5. Ù¾Ø§Ø³Ø® Ø¯Ø³ØªÛŒ Ø¯Ø± Ù…ØªØ§ Ø¨Ø§Ú©Ø³:</strong> Ù‡Ù†Ú¯Ø§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒÚ© Ù†Ø¸Ø±ØŒ Ø¯Ø± Ø¨Ø®Ø´ Ù…ØªØ§ Ø¨Ø§Ú©Ø³ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ØŒ Ø¯Ú©Ù…Ù‡ <strong>"ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯"</strong> ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨Ø± Ø¢Ù†ØŒ Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.</p>
                    <p><strong>6. Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§:</strong> Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§ØªØŒ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ ÛŒØ§ Ø§Ù†ÙˆØ§Ø¹ Ù…Ø­ØªÙˆØ§ØŒ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø±Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.</p>
                    <p><strong>7. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡:</strong> Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„ØŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ù„Ø§Ú¯ÛŒÙ† Ø¨Ù‡ Ø¬Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ø§Ø² Ø¢Ù†â€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯.</p>
                    <p><strong>8. Ø¯ÛŒØ¨Ø§Ú¯:</strong> Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù‡ Ùˆ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
                    <p>  Ø¨Ø±Ø§ÛŒ ØªÙ‡ÛŒÙ‡ ØªÙˆÚ©Ù† Ø§Ø² one api Ø¨Ù‡ ÙˆØ¨Ø³Ø§ÛŒØª  Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯ one-api.ir</p>
                </div>
            </div>
            <!-- Ø¨Ø®Ø´ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ -->
            <div class="bg-white shadow-sm rounded-lg p-6 mb-8">
                <p class="text-xl font-semibold mb-4 text-gray-700">ØªØ­Ù„ÛŒÙ„ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø¸Ø±Ø§Øª</p>
                <p class="text-gray-600 mb-6">
                    Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ø§Ø² Ø±ÙˆÙ†Ø¯ Ù†Ø¸Ø±Ø§Øª Ø¯Ø± Ø³Ø§ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.
                    <br>
                    <strong class="text-red-600">âš ï¸ ØªÙˆØ¬Ù‡:</strong> Ø§ÛŒÙ† ØªØ­Ù„ÛŒÙ„ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù‡Ø²ÛŒÙ†Ù‡ API Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.
                </p>
                <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÛŒÙ„Ù‡â€ŒØ§ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <p class="text-md font-medium text-gray-700 mb-4">Ù†Ù…ÙˆØ¯Ø§Ø± Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ù†Ø¸Ø±Ø§Øª</p>
                    <canvas id="comments-chart" class="w-full h-64"></canvas>
                </div>
                <!-- ÙØ±Ù… ØªØ¹Ø§Ù…Ù„ÛŒ -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ØªØ¹Ø¯Ø§Ø¯ Ù†Ø¸Ø±Ø§Øª Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„</label>
                            <select id="analysis-count" class="block w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="10">Û±Û° Ù†Ø¸Ø± Ø¢Ø®Ø±</option>
                                <option value="25" selected>Û²Ûµ Ù†Ø¸Ø± Ø¢Ø®Ø±</option>
                                <option value="50">ÛµÛ° Ù†Ø¸Ø± Ø¢Ø®Ø±</option>
                                <option value="100">Û±Û°Û° Ù†Ø¸Ø± Ø¢Ø®Ø±</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</label>
                            <select id="analysis-period" class="block w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="7">Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                                <option value="30" selected>Û³Û° Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                                <option value="90">Û¹Û° Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                                <option value="all">Ù‡Ù…Ù‡ Ù†Ø¸Ø±Ø§Øª</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ù†ÙˆØ¹ Ù†Ø¸Ø±Ø§Øª</label>
                            <select id="analysis-type" class="block w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="all" selected>Ù‡Ù…Ù‡ Ù†Ø¸Ø±Ø§Øª</option>
                                <option value="review">ÙÙ‚Ø· Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª</option>
                                <option value="comment">ÙÙ‚Ø· Ù†Ø¸Ø±Ø§Øª Ù…Ø·Ø§Ù„Ø¨</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" id="start-analysis" class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
                        Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯
                    </button>
                </div>
                <!-- Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„ -->
                <div id="analysis-results" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-md font-medium text-gray-700">Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„</p>
                        <button type="button" id="download-analysis-pdf" class="px-3 py-1 bg-gray-200 text-gray-800 text-xs font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                            Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF
                        </button>
                    </div>
                    <div id="analysis-content" class="bg-gray-50 p-4 rounded-lg prose max-w-none"></div>
                </div>
                <!-- ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ -->
                <div id="analysis-status" class="hidden mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12pzm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sm text-blue-700">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ù†Ø¸Ø±Ø§Øª ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.</span>
                    </div>
                </div>
            </div>
            <div class="bg-white shadow-sm rounded-lg p-6 mb-8">
                <?php $this->tasks_page() ?>
            </div>
            <!-- Ø¨Ø®Ø´ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ùˆ Ø¢Ù…Ø§Ø± -->
            <div class="bg-white shadow-sm rounded-lg p-6 mb-8">
                <p class="text-xl font-semibold mb-4 text-gray-700">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹</p>
                <p class="text-gray-600 mb-6">Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªÙ…Ø§Ù…ÛŒ Ø¬Ù†Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ù„Ø§Ú¯ÛŒÙ† Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯.</p>
                <div id="dashboard-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-gray-500">Ù†Ø¸Ø±Ø§Øª Ú©Ù„</p>
                        <div class="text-2xl font-bold text-gray-900 mt-1" id="stat-total-comments">--</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-gray-500">Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„</p>
                        <div class="text-2xl font-bold text-gray-900 mt-1" id="stat-total-reviews">--</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-gray-500">Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</p>
                        <div class="text-2xl font-bold text-gray-900 mt-1" id="stat-ai-replies">--</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-gray-500">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</p>
                        <div class="text-2xl font-bold text-gray-900 mt-1" id="stat-pending-comments">--</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 text-center">
                        <p class="text-sm font-medium text-gray-500">Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</p>
                        <div class="text-2xl font-bold text-gray-900 mt-1" id="stat-last-7-days">--</div>
                    </div>
                </div>
                <button type="button" id="refresh-dashboard-stats" class="px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
                </button>
            </div>
            <!-- Ø¨Ø®Ø´ Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Ø³ØªÙˆÙ† 1: Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹ -->
                <div class="bg-white shadow-sm rounded-lg p-6">
                    <p class="text-xl font-semibold mb-4 text-gray-700">Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹</p>
                    <div class="space-y-3">
                        <a href="<?php echo admin_url('edit-comments.php'); ?>" class="block w-full text-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø±Ø§Øª
                        </a>
                        <a href="<?php echo admin_url('admin.php?page=wc-ai-review-settings'); ?>" class="block w-full text-center px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">
                            ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ù„Ø§Ú¯ÛŒÙ†
                        </a>
                        <a href="<?php echo admin_url('admin.php?page=wc-ai-review-debug'); ?>" class="block w-full text-center px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">
                            Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
                        </a>
                        <a href="<?php echo admin_url('admin.php?page=wc-ai-review-tasks'); ?>" class="block w-full text-center px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">
                            ÙˆØ¸Ø§ÛŒÙ
                        </a>
                    </div>
                </div>
                <!-- Ø³ØªÙˆÙ† 2: ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… -->
                <div class="bg-white shadow-sm rounded-lg p-6">
                    <p class="text-xl font-semibold mb-4 text-gray-700">ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</p>
                    <ul class="space-y-4">
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-600 font-medium">ÙˆÙˆÚ©Ø§Ù…Ø±Ø³:</span>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full <?php echo class_exists('WooCommerce') ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>">
                                <?php echo class_exists('WooCommerce') ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'; ?>
                            </span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-600 font-medium">Ú©Ù„ÛŒØ¯ API:</span>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full <?php echo !empty($this->options['api_key']) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>">
                                <?php echo !empty($this->options['api_key']) ? 'ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡' : 'ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡'; ?>
                            </span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-600 font-medium">Ú©Ø§Ø±Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ:</span>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full <?php echo $this->ai_user_id && get_user_by('id', $this->ai_user_id) ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>">
                                <?php echo $this->ai_user_id && get_user_by('id', $this->ai_user_id) ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'; ?>
                            </span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-600 font-medium">Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±:</span>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full <?php echo isset($this->options['auto_reply']) && $this->options['auto_reply'] === '1' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'; ?>">
                                <?php echo isset($this->options['auto_reply']) && $this->options['auto_reply'] === '1' ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'; ?>
                            </span>
                        </li>
                    </ul>
                </div>
                <!-- Ø³ØªÙˆÙ† 3: Ø¢Ø®Ø±ÛŒÙ† Ù†Ø¸Ø±Ø§Øª -->
                <div class="bg-white shadow-sm rounded-lg p-6">
                    <p class="text-xl font-semibold mb-4 text-gray-700">Ø¢Ø®Ø±ÛŒÙ† Ù†Ø¸Ø±Ø§Øª</p>
                    <p class="text-gray-600 mb-4">Ø¢Ø®Ø±ÛŒÙ† Ù†Ø¸Ø±Ø§Øª Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¯Ø± ÙˆØ¨Ø³Ø§ÛŒØªØªØ§Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        <?php
                        $recent_comments = get_comments(array(
                            'status' => 'approve',
                            'number' => 5,
                            'orderby' => 'comment_date',
                            'order' => 'DESC'
                        ));
                        if (empty($recent_comments)) {
                            echo '<p class="text-gray-500 text-center py-4">Ù‡ÛŒÚ† Ù†Ø¸Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
                        } else {
                            foreach ($recent_comments as $comment) {
                                $post = get_post($comment->comment_post_ID);
                                ?>
                                <div class="p-3 bg-gray-50 rounded-md border border-gray-200">
                                    <div class="flex justify-between items-start">
                                        <div class="text-sm">
                                            <strong class="text-gray-800"><?php echo esc_html($comment->comment_author); ?></strong>
                                            <span class="text-gray-500"> Ø¯Ø± </span>
                                            <span class="text-gray-500 text-xs"><?php echo date('Y-m-d H:i', strtotime($comment->comment_date)); ?></span>
                                        </div>
                                        <a href="<?php echo get_comment_link($comment->comment_ID); ?>" target="_blank" class="text-indigo-600 hover:text-indigo-800 text-xs">Ù…Ø´Ø§Ù‡Ø¯Ù‡</a>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2 line-clamp-2"><?php echo wp_trim_words($comment->comment_content, 15); ?></p>
                                    <?php if ($post): ?>
                                        <p class="text-xs text-gray-500 mt-1">Ø¨Ø±Ø§ÛŒ: <a href="<?php echo get_permalink($post->ID); ?>" target="_blank" class="text-indigo-600 hover:underline"><?php echo esc_html($post->post_title); ?></a></p>
                                    <?php endif; ?>
                                </div>
                                <?php
                            }
                        }
                        ?>
                    </div>
                    <a href="<?php echo admin_url('edit-comments.php'); ?>" class="block w-full text-center mt-4 px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">
                        Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ Ù†Ø¸Ø±Ø§Øª
                    </a>
                </div>
            </div>
        </div>
        <!-- Chart.js Library -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            jQuery(document).ready(function($) {
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¢Ù…Ø§Ø±
                const ctx = document.getElementById('comments-chart').getContext('2d');
                const commentsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Ù†Ø¸Ø±Ø§Øª Ú©Ù„', 'Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§', 'Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯', 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±', 'Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡'],
                        datasets: [{
                            label: 'ØªØ¹Ø¯Ø§Ø¯ Ù†Ø¸Ø±Ø§Øª',
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.5)',
                                'rgba(16, 185, 129, 0.5)',
                                'rgba(245, 158, 11, 0.5)',
                                'rgba(239, 68, 68, 0.5)',
                                'rgba(139, 92, 246, 0.5)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(239, 68, 68, 1)',
                                'rgba(139, 92, 246, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                function refreshDashboardStats() {
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'get_comment_stats',
                            nonce: wc_ai_review.nonce
                        },
                        success: function(response) {
                            if (response.success) {
                                $('#stat-total-comments').text(response.data.total_comments);
                                $('#stat-total-reviews').text(response.data.total_reviews);
                                $('#stat-ai-replies').text(response.data.ai_replies);
                                $('#stat-pending-comments').text(response.data.pending_comments);
                                $('#stat-last-7-days').text(response.data.last_7_days);
                                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
                                commentsChart.data.datasets[0].data = [
                                    response.data.total_comments,
                                    response.data.total_reviews,
                                    response.data.ai_replies,
                                    response.data.pending_comments,
                                    response.data.last_7_days
                                ];
                                commentsChart.update();
                            }
                        }
                    });
                }
                // Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯
                $('#start-analysis').on('click', function() {
                    if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù‡Ø²ÛŒÙ†Ù‡ API Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.')) {
                        return;
                    }
                    var $button = $(this);
                    var $status = $('#analysis-status');
                    var $results = $('#analysis-results');
                    var $content = $('#analysis-content');
                    $button.prop('disabled', true);
                    $status.removeClass('hidden');
                    $results.addClass('hidden');
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'generate_ai_analysis',
                            count: $('#analysis-count').val(),
                            period: $('#analysis-period').val(),
                            type: $('#analysis-type').val(),
                            nonce: wc_ai_review.nonce
                        },
                        success: function(response) {
                            if (response.success) {
                                $content.html(response.data.html);
                                $results.removeClass('hidden');
                            } else {
                                alert('Ø®Ø·Ø§: ' + response.data);
                            }
                        },
                        error: function() {
                            alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                        },
                        complete: function() {
                            $button.prop('disabled', false);
                            $status.addClass('hidden');
                        }
                    });
                });
                // Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF
                $(document).on('click', '#download-analysis-pdf', function() {
                    var analysisHtml = $('#analysis-content').html();
                    if (!analysisHtml) {
                        alert('Ù‡ÛŒÚ† ØªØ­Ù„ÛŒÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
                        return;
                    }
                    window.open('<?php echo admin_url('admin-ajax.php'); ?>?action=download_analysis_pdf&html=' + encodeURIComponent(analysisHtml) + '&nonce=<?php echo wp_create_nonce('wc_ai_review_nonce'); ?>', '_blank');
                });
                // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒÚ©
                $('#refresh-dashboard-stats').on('click', refreshDashboardStats);
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¢Ù…Ø§Ø±
                refreshDashboardStats();
            });
        </script>
        <?php
    }
    public function settings_page() {
        ?>
        <div class="wc-ai-review-settings p-6" dir="rtl">
            <div class="flex justify-between items-center mb-6">
                <span class="text-xl font-bold">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ù‡ Ù†Ø¸Ø±Ø§Øª</span>
            </div>
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <span class="block text-lg font-medium mb-4">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</span>
                <p class="text-sm text-gray-600 mb-4">ÛŒÚ© Ù†Ø¸Ø± Ù†Ù…ÙˆÙ†Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.</p>
                <textarea id="live-preview-input" rows="4" class="block w-full p-3 mb-4 border border-gray-300 rounded-md" placeholder="Ù†Ø¸Ø± Ù†Ù…ÙˆÙ†Ù‡ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                <button type="button" id="generate-live-preview" class="px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700">ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</button>
                <div id="live-preview-output" class="mt-4 p-4 bg-gray-50 rounded-md hidden"></div>
            </div>
            <form action="options.php" method="post" class="bg-white shadow rounded-lg p-6">
                <?php
                settings_fields('wc_ai_review');
                do_settings_sections('wc_ai_review');
                submit_button('Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'primary', 'submit', true, array('class' => 'px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700'));
                ?>
            </form>
        </div>
        <script>
            jQuery(document).ready(function($) {
                $('#generate-live-preview').on('click', function() {
                    var $button = $(this);
                    var $output = $('#live-preview-output');
                    var sample_comment = $('#live-preview-input').val();
                    if (!sample_comment) {
                        alert('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù†Ø¸Ø± Ù†Ù…ÙˆÙ†Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
                        return;
                    }
                    $button.prop('disabled', true).text('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...');
                    $output.html('').addClass('hidden');
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'generate_live_preview',
                            sample_comment: sample_comment,
                            nonce: wc_ai_review.nonce
                        },
                        success: function(response) {
                            if (response.success) {
                                $output.html('<strong>Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong><br>' + response.data.reply).removeClass('hidden');
                            } else {
                                $output.html('<span class="text-red-600">Ø®Ø·Ø§: ' + response.data + '</span>').removeClass('hidden');
                            }
                        },
                        error: function() {
                            $output.html('<span class="text-red-600">Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±</span>').removeClass('hidden');
                        },
                        complete: function() {
                            $button.prop('disabled', false).text('ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´');
                        }
                    });
                });
            });
        </script>
        <?php
    }
    public function debug_page() {
        ?>
        <div class="wc-ai-review-debug" dir="rtl">
            <div class="flex justify-between items-center mb-8">
                <p class="text-2xl font-bold text-gray-800">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ</p>
            </div>
            <div class="bg-white shadow-sm rounded-lg p-6 mb-8">
                <p class="text-lg font-semibold mb-4 text-gray-700">Ø¹Ù…Ù„ÛŒØ§Øª Ø¯ÛŒØ¨Ø§Ú¯</p>
                <div class="space-y-4">
                    <div>
                        <button type="button" class="debug-action px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" data-action="clear_logs">
                            Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§
                        </button>
                    </div>
                    <div>
                        <button type="button" class="debug-action px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-action="test_email">
                            ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„
                        </button>
                    </div>
                    <div>
                        <button type="button" class="debug-action px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500" data-action="check_db">
                            Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                        </button>
                    </div>
                    <div>
                        <button type="button" class="debug-action px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" data-action="rebuild_tables">
                            Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø¬Ø¯Ø§ÙˆÙ„ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                        </button>
                    </div>
                </div>
                <div id="debug-result" class="mt-6"></div>
            </div>
            <div class="bg-white shadow-sm rounded-lg p-6">
                <p class="text-lg font-semibold mb-4 text-gray-700">Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</p>
                <?php if (isset($this->options['debug_mode']) && $this->options['debug_mode'] === '1'): ?>
                    <?php
                    global $wpdb;
                    $table_name = $wpdb->prefix . 'wc_ai_review_logs';
                    $logs = $wpdb->get_results("SELECT * FROM $table_name ORDER BY time DESC LIMIT 100");
                    ?>
                    <?php if ($logs): ?>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø²Ù…Ø§Ù†</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù†Ø¸Ø±</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ù…Ù„</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù¾ÛŒØ§Ù…</th>
                                </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                <?php foreach ($logs as $log): ?>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo date('Y-m-d H:i:s', strtotime($log->time)); ?></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><?php echo $log->comment_id; ?></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><?php echo $log->action; ?></td>
                                        <td class="px-6 py-4 text-sm text-gray-500"><?php echo $log->message; ?></td>
                                    </tr>
                                <?php endforeach; ?>
                                </tbody>
                            </table>
                        </div>
                    <?php else: ?>
                        <p class="text-gray-500">Ù‡ÛŒÚ† Ù„Ø§Ú¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                    <?php endif; ?>
                <?php else: ?>
                    <div class="bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded-md">
                        <p>Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ØŒ Ù„Ø·ÙØ§Ù‹ Ø­Ø§Ù„Øª Ø¯ÛŒØ¨Ø§Ú¯ Ø±Ø§ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.</p>
                    </div>
                <?php endif; ?>
            </div>
        </div>
        <?php
    }
    public function generate_live_preview_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $sample_comment = isset($_POST['sample_comment']) ? sanitize_textarea_field($_POST['sample_comment']) : '';
        if (empty($sample_comment)) {
            wp_send_json_error('Ù†Ø¸Ø± Ù†Ù…ÙˆÙ†Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.');
        }
        // Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ù¾Ø§Ø³Ø® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        $fake_product_info = array(
            'title' => 'Ù…Ø­ØµÙˆÙ„ Ù†Ù…ÙˆÙ†Ù‡',
            'short_description' => 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ÙˆØªØ§Ù‡ Ù…Ø­ØµÙˆÙ„ Ù†Ù…ÙˆÙ†Ù‡',
            'attributes' => 'Ø±Ù†Ú¯: Ù‚Ø±Ù…Ø², Ø³Ø§ÛŒØ²: M',
            'description' => 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡.'
        );
        $prompt = $this->build_prompt($fake_product_info, $sample_comment, array());
        $response = $this->call_ai_api($prompt);
        if (is_wp_error($response)) {
            wp_send_json_error($response->get_error_message());
        }
        wp_send_json_success(array('reply' => $response));
    }
    public function handle_comment_submission($comment_id, $comment_approved, $commentdata) {
        $this->add_log($comment_id, 'comment_submitted', 'Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', $commentdata);
        // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ù†Ø¸Ø±
        if ($this->is_duplicate_comment($commentdata)) {
            $this->handle_duplicate_comment($comment_id, $commentdata);
            return;
        }
        // ÙÙ‚Ø· Ø§Ú¯Ø± Ù†Ø¸Ø± Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒÙ…
        // Ø§Ú¯Ø± ØªØ§ÛŒÛŒØ¯ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‡ÙˆÚ© `comment_unapproved_to_approved` Ù…Ø±Ø§Ù‚Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
        if ($comment_approved === 1 && $this->is_auto_reply_enabled()) {
            $this->generate_and_post_reply($comment_id);
        }
    }
    public function forbidden_response_render() {
        $value = isset($this->options['forbidden_response']) ? $this->options['forbidden_response'] : 'Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø­Ø§ÙˆÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø¨ÙˆØ¯ Ùˆ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ØªØ´Ø± Ø´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¨Ù‡ Ú©Ø§Ø± Ø¨Ø±Ø¯Ù† Ø²Ø¨Ø§Ù† Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ ÙØ±Ù…Ø§ÛŒÛŒØ¯. Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² Ù‡Ù…Ø±Ø§Ù‡ÛŒ Ø´Ù…Ø§.';
        ?>
        <textarea name="wc_ai_review_settings[forbidden_response]" rows="5" class="large-text" placeholder="Ù…ØªÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ÛŒ Ú©Ù‡ Ø§Ø² Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯"><?php echo esc_textarea($value); ?></textarea>
        <p class="description">Ø§ÛŒÙ† Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø± Ù†Ø¸Ø±Ø´Ø§Ù† Ø§Ø² Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        <?php
    }
    public function handle_comment_status_change($comment_id, $comment_status) {
        if ($comment_status === 'approve' && $this->is_auto_reply_enabled()) {
            $this->generate_and_post_reply($comment_id);
        }
    }
    public function maybe_auto_reply_on_approval($comment) {
        // ÙÙ‚Ø· Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù¾Ø§Ø³Ø® Ø¬Ø¯ÛŒØ¯ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒÙ…
        if ($this->is_auto_reply_enabled() && !$this->has_already_replied($comment->comment_ID)) {
            $this->generate_and_post_reply($comment->comment_ID);
        }
    }
    private function check_for_canned_response($customer_comment) {
        $canned_responses = isset($this->options['canned_responses']) ? $this->options['canned_responses'] : array();
        foreach ($canned_responses as $item) {
            if (empty($item['trigger']) || empty($item['response'])) {
                continue;
            }
            // Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø¯Ø± Ù†Ø¸Ø± (ØºÛŒØ±Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ø¨Ø²Ø±Ú¯ÛŒ Ùˆ Ú©ÙˆÚ†Ú©ÛŒ Ø­Ø±ÙˆÙ)
            if (stripos($customer_comment, $item['trigger']) !== false) {
                return $item['response'];
            }
        }
        return false; // Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯
    }
    private function is_auto_reply_enabled() {
        return isset($this->options['auto_reply']) && $this->options['auto_reply'] === '1';
    }
    private function should_preview_replies() {
        return isset($this->options['preview_replies']) && $this->options['preview_replies'] === '1';
    }
    public function prevent_duplicate_comments($approved, $commentdata) {
        if (!isset($this->options['spam_prevention']) || $this->options['spam_prevention'] !== '1') {
            return $approved;
        }
        if ($this->is_duplicate_comment($commentdata)) {
            $this->add_log(0, 'duplicate_prevented', 'Ù†Ø¸Ø± ØªÚ©Ø±Ø§Ø±ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯', $commentdata);
            $action = isset($this->options['spam_action']) ? $this->options['spam_action'] : 'trash';
            if ($action === 'delete') {
                wp_die(__('Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ø­Ø°Ù Ø´Ø¯.', 'wc-ai-review-reply-pro'));
            } else {
                if ($action === 'mark_spam') return 'spam';
                if ($action === 'trash') return 'trash';
                if ($action === 'hold') return '0';
            }
        }
        return $approved;
    }
    private function is_duplicate_comment($commentdata) {
        global $wpdb;
        $duplicate = $wpdb->get_var($wpdb->prepare(
            "SELECT COUNT(*) FROM $wpdb->comments 
            WHERE comment_author = %s 
            AND comment_author_email = %s 
            AND comment_content = %s 
            AND comment_date >= DATE_SUB(NOW(), INTERVAL 1 DAY)
            AND comment_approved != 'trash'",
            $commentdata['comment_author'],
            $commentdata['comment_author_email'],
            $commentdata['comment_content']
        ));
        return $duplicate > 0;
    }
    private function handle_duplicate_comment($comment_id, $commentdata) {
        $action = isset($this->options['spam_action']) ? $this->options['spam_action'] : 'trash';
        switch ($action) {
            case 'delete':
                wp_delete_comment($comment_id, true);
                break;
            case 'trash':
                wp_trash_comment($comment_id);
                break;
            case 'mark_spam':
                wp_set_comment_status($comment_id, 'spam');
                break;
            case 'hold':
                wp_set_comment_status($comment_id, 'hold');
                break;
        }
        $this->add_log($comment_id, 'duplicate_handled', 'Ù†Ø¸Ø± ØªÚ©Ø±Ø§Ø±ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯: ' . $action, $commentdata);
    }
    public function generate_ai_reply_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('moderate_comments')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $comment_id = isset($_POST['comment_id']) ? intval($_POST['comment_id']) : 0;
        $post_reply = isset($_POST['post_reply']) ? $_POST['post_reply'] === 'true' : false;
        if (!$comment_id) {
            wp_send_json_error(__('Ø´Ù†Ø§Ø³Ù‡ Ù†Ø¸Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'wc-ai-review-reply-pro'));
        }
        $reply = $this->generate_ai_reply($comment_id);
        if (is_wp_error($reply)) {
            wp_send_json_error($reply->get_error_message());
        }
        // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¨Ø¨ÛŒÙ†Ø¯
        if (!$post_reply) {
            wp_send_json_success(array(
                'reply' => $reply,
                'preview' => true
            ));
        }
        // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ Ù¾Ø§Ø³Ø® Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
        $result = $this->post_reply($comment_id, $reply);
        if (is_wp_error($result)) {
            wp_send_json_error($result->get_error_message());
        }
        wp_send_json_success(array(
            'message' => __('Ù¾Ø§Ø³Ø® Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'wc-ai-review-reply-pro'),
            'preview' => false
        ));
    }
    public function test_ai_connection_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $test_prompt = "Ø³Ù„Ø§Ù…! Ø§ÛŒÙ† ÛŒÚ© ØªØ³Øª Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ 'Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚' Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.";
        $response = $this->call_ai_api($test_prompt);
        if (is_wp_error($response)) {
            wp_send_json_error($response->get_error_message());
        }
        wp_send_json_success(array(
            'message' => __('Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯', 'wc-ai-review-reply-pro'),
            'response' => $response
        ));
    }
    public function debug_plugin_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $action = isset($_POST['debug_action']) ? $_POST['debug_action'] : '';
        switch ($action) {
            case 'clear_logs':
                $this->clear_logs();
                wp_send_json_success(__('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'wc-ai-review-reply-pro'));
                break;
            case 'test_email':
                $email = get_option('admin_email');
                $subject = 'ØªØ³Øª Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø² Ù¾Ù„Ø§Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯';
                $message = 'Ø§ÛŒÙ† ÛŒÚ© Ø§ÛŒÙ…ÛŒÙ„ ØªØ³ØªÛŒ Ø§Ø³Øª ØªØ§ Ø§Ø² ØµØ­Øª Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ø´ÙˆØ¯.';
                if (wp_mail($email, $subject, $message)) {
                    wp_send_json_success(__('Ø§ÛŒÙ…ÛŒÙ„ ØªØ³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'wc-ai-review-reply-pro'));
                } else {
                    wp_send_json_error(__('Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯', 'wc-ai-review-reply-pro'));
                }
                break;
            case 'check_db':
                global $wpdb;
                $table_name = $wpdb->prefix . 'wc_ai_review_logs';
                if ($wpdb->get_var("SHOW TABLES LIKE '$table_name'") != $table_name) {
                    wp_send_json_error(__('Ø¬Ø¯ÙˆÙ„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'wc-ai-review-reply-pro'));
                } else {
                    $count = $wpdb->get_var("SELECT COUNT(*) FROM $table_name");
                    wp_send_json_success(sprintf(__('Ø¬Ø¯ÙˆÙ„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ùˆ Ø´Ø§Ù…Ù„ %d Ø±Ú©ÙˆØ±Ø¯ Ø§Ø³Øª', 'wc-ai-review-reply-pro'), $count));
                }
                break;
            case 'rebuild_tables':
                $this->create_log_table();
                wp_send_json_success(__('Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù†Ø¯', 'wc-ai-review-reply-pro'));
                break;
            default:
                wp_send_json_error(__('Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯ÛŒØ¨Ø§Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'wc-ai-review-reply-pro'));
        }
    }
    public function get_comment_stats_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('moderate_comments')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        global $wpdb;
        $stats = array(
            'total_comments' => (int) $wpdb->get_var("SELECT COUNT(*) FROM $wpdb->comments WHERE comment_type = '' OR comment_type = 'comment'"),
            'total_reviews' => (int) $wpdb->get_var("SELECT COUNT(*) FROM $wpdb->comments WHERE comment_type = 'review'"),
            'ai_replies' => (int) $wpdb->get_var($wpdb->prepare(
                "SELECT COUNT(*) FROM $wpdb->comments WHERE comment_author LIKE %s",
                '%Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ%'
            )),
            'pending_comments' => (int) $wpdb->get_var("SELECT COUNT(*) FROM $wpdb->comments WHERE comment_approved = '0'"),
            'last_7_days' => (int) $wpdb->get_var("SELECT COUNT(*) FROM $wpdb->comments WHERE comment_date >= DATE_SUB(NOW(), INTERVAL 7 DAY)")
        );
        wp_send_json_success($stats);
    }
    public function toggle_comment_exception_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('moderate_comments')) {
            wp_die(__('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²', 'wc-ai-review-reply-pro'));
        }
        $comment_id = isset($_POST['comment_id']) ? intval($_POST['comment_id']) : 0;
        if (!$comment_id) {
            wp_send_json_error(__('Ø´Ù†Ø§Ø³Ù‡ Ù†Ø¸Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'wc-ai-review-reply-pro'));
        }
        $comment = get_comment($comment_id);
        if (!$comment) {
            wp_send_json_error(__('Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'wc-ai-review-reply-pro'));
        }
        $post_id = $comment->comment_post_ID;
        $excluded_posts = get_option('_wc_ai_review_excluded_posts', array());
        if (in_array($post_id, $excluded_posts)) {
            $excluded_posts = array_diff($excluded_posts, array($post_id));
            $message = 'Ù…Ø·Ù„Ø¨ Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§ Ø­Ø°Ù Ø´Ø¯.';
        } else {
            $excluded_posts[] = $post_id;
            $message = 'Ù…Ø·Ù„Ø¨ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.';
        }
        update_option('_wc_ai_review_excluded_posts', array_values($excluded_posts));
        wp_send_json_success(array('message' => $message));
    }
    private function clear_logs() {
        global $wpdb;
        $table_name = $wpdb->prefix . 'wc_ai_review_logs';
        $wpdb->query("TRUNCATE TABLE $table_name");
    }
    private function has_already_replied($comment_id) {
        // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ÙˆØ§Ù„Ø¯ Ø§ÛŒÙ† Ù†Ø¸Ø± Ù‡Ø³ØªÙ†Ø¯ Ùˆ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± ØªØ¹ÛŒÛŒÙ† Ø´Ø¯Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.
        $replies = get_comments(array(
            'parent' => $comment_id,
            'status' => 'approve',
            'type' => 'comment',
            'number' => 1, // ÙÙ‚Ø· ÛŒÚ© Ù…ÙˆØ±Ø¯ Ú©Ø§ÙÛŒ Ø§Ø³Øª
            'orderby' => 'comment_date',
            'order' => 'DESC'
        ));
        foreach ($replies as $reply) {
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù¾Ø§Ø³Ø® ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± ØªØ¹ÛŒÛŒÙ† Ø´Ø¯Ù‡ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª
            $reply_user = isset($this->options['reply_user']) ? $this->options['reply_user'] : 'ai';
            if ($reply_user === 'ai') {
                if ($reply->user_id === $this->ai_user_id) {
                    return true; // Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
                }
            } else {
                if ($reply->user_id == $reply_user) {
                    return true; // Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
                }
            }
        }
        return false; // Ù‡Ù†ÙˆØ² Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
    }
    private function generate_and_post_reply($comment_id) {
        // Ù„Ø§ÛŒÙ‡ 1: Ø¨Ø±Ø±Ø³ÛŒ Transient (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§Ø³Ø® ØªÚ©Ø±Ø§Ø±ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ú©ÙˆØªØ§Ù‡)
        $transient_key = $this->transient_prefix . $comment_id;
        if (get_transient($transient_key)) {
            $this->add_log($comment_id, 'duplicate_attempt', 'Ù¾Ø§Ø³Ø® ØªÚ©Ø±Ø§Ø±ÛŒ: transient ÙØ¹Ø§Ù„ Ø§Ø³Øª');
            return;
        }
        // Ù„Ø§ÛŒÙ‡ 2: Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ù‡ Ø§ÛŒÙ† Ù†Ø¸Ø± Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒÙ… ÛŒØ§ Ø®ÛŒØ±
        if ($this->has_already_replied($comment_id)) {
            $this->add_log($comment_id, 'duplicate_attempt', 'Ù¾Ø§Ø³Ø® ØªÚ©Ø±Ø§Ø±ÛŒ: Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª');
            return;
        }
        // Ù„Ø§ÛŒÙ‡ 3: Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§
        if ($this->is_excluded($comment_id)) {
            $this->add_log($comment_id, 'excluded', 'Ù†Ø¸Ø± Ø¯Ø± Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯');
            return;
        }
        // ØªØ¹ÛŒÛŒÙ† Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ÙˆØ§Ù†ÛŒÙ†
        $scheduled_time = $this->calculate_scheduled_time($comment_id);
        if ($scheduled_time === null) {
            $this->add_log($comment_id, 'scheduling_failed', 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯');
            return;
        }
        // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø§Ø³Ø® Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¢ÛŒÙ†Ø¯Ù‡
        $this->schedule_reply($comment_id, $scheduled_time);
        $this->add_log($comment_id, 'reply_scheduled', 'Ù¾Ø§Ø³Ø® Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø± Ø²Ù…Ø§Ù† Ù…Ø´Ø®Øµ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯', array('scheduled_time' => $scheduled_time));
        // ØªÙ†Ø¸ÛŒÙ… transient Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø¬Ø¯Ø¯ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ú©ÙˆØªØ§Ù‡
        set_transient($transient_key, true, 5 * MINUTE_IN_SECONDS); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ú©Ø§ÙÛŒ Ø§Ø³Øª
    }
    private function calculate_scheduled_time($comment_id) {
        $comment = get_comment($comment_id);
        $current_time = current_time('timestamp');
        $default_delay = isset($this->options['default_delay']) ? intval($this->options['default_delay']) : 60;
        $scheduled_time = $current_time + ($default_delay * 60); // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ù‡ Ø«Ø§Ù†ÛŒÙ‡
        // Ø¨Ø±Ø±Ø³ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ø±Ø·ÛŒ
        $scheduling_rules = isset($this->options['scheduling_rules']) ? $this->options['scheduling_rules'] : array();
        foreach ($scheduling_rules as $rule) {
            $keywords = isset($rule['keywords']) ? explode(',', $rule['keywords']) : array();
            $delay = isset($rule['delay']) ? intval($rule['delay']) : 0;
            $time_range = isset($rule['time_range']) ? $rule['time_range'] : '';
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø¯Ø± Ù†Ø¸Ø±
            $match_found = false;
            foreach ($keywords as $keyword) {
                $keyword = trim($keyword);
                if (!empty($keyword) && stripos($comment->comment_content, $keyword) !== false) {
                    $match_found = true;
                    break;
                }
            }
            if ($match_found) {
                $rule_time = $current_time + ($delay * 60);
                // Ø§Ú¯Ø± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
                if (!empty($time_range) && strpos($time_range, '-') !== false) {
                    list($start_time, $end_time) = explode('-', $time_range);
                    $start_timestamp = strtotime(date('Y-m-d') . ' ' . trim($start_time));
                    $end_timestamp = strtotime(date('Y-m-d') . ' ' . trim($end_time));
                    // Ø§Ú¯Ø± Ø²Ù…Ø§Ù† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¨Ø§Ø²Ù‡ Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ Ø¨Ø§Ø²Ù‡ Ø¨Ø¹Ø¯ÛŒ Ù…Ù†ØªÙ‚Ù„ Ú©Ù†ÛŒØ¯
                    if ($rule_time < $start_timestamp) {
                        $rule_time = $start_timestamp;
                    } elseif ($rule_time > $end_timestamp) {
                        // Ø§Ú¯Ø± Ø§Ù…Ø±ÙˆØ² ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ØŒ Ø¨Ù‡ ÙØ±Ø¯Ø§ÛŒ Ù‡Ù…Ø§Ù† Ø¨Ø§Ø²Ù‡
                        $rule_time = $start_timestamp + (24 * 60 * 60);
                    }
                }
                $scheduled_time = $rule_time;
                break; // Ø§ÙˆÙ„ÛŒÙ† Ù‚Ø§Ù†ÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            }
        }
        return date('Y-m-d H:i:s', $scheduled_time);
    }
    private function schedule_reply($comment_id, $scheduled_time) {
        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± ÛŒÚ© option Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø¹Ø¯ÛŒ
        $scheduled_replies = get_option('_wc_ai_review_scheduled_replies', array());
        $scheduled_replies[] = array(
            'comment_id' => $comment_id,
            'scheduled_time' => $scheduled_time,
            'status' => 'pending'
        );
        update_option('_wc_ai_review_scheduled_replies', $scheduled_replies);
        // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† cron job
        if (!wp_next_scheduled('wc_ai_review_check_scheduled_replies')) {
            wp_schedule_event(time(), 'minute', 'wc_ai_review_check_scheduled_replies');
        }
    }
    private function is_excluded($comment_id) {
        $comment = get_comment($comment_id);
        if (!$comment) {
            return false;
        }
        $post_id = $comment->comment_post_ID;
        $post_type = get_post_type($post_id);
        if (isset($this->options['only_products']) && $this->options['only_products'] === '1' && $post_type !== 'product') {
            return true;
        }
        $excluded_post_types = isset($this->options['excluded_post_types']) ? $this->options['excluded_post_types'] : array();
        if (in_array($post_type, $excluded_post_types)) {
            return true;
        }
        $excluded_products = isset($this->options['excluded_products']) ? $this->options['excluded_products'] : array();
        if (in_array($post_id, $excluded_products)) {
            return true;
        }
        $global_excluded = get_option('_wc_ai_review_excluded_posts', array());
        if (in_array($post_id, $global_excluded)) {
            return true;
        }
        if ($post_type === 'product') {
            $excluded_categories = isset($this->options['excluded_categories']) ? $this->options['excluded_categories'] : array();
            $product_categories = wp_get_post_terms($post_id, 'product_cat', array('fields' => 'ids'));
            if (!empty(array_intersect($excluded_categories, $product_categories))) {
                return true;
            }
        }
        return false;
    }
    private function requires_human_intervention_intelligent($customer_comment, $ai_response) {
        // Ø³Ø§Ø®Øª ÛŒÚ© Ù¾Ø±Ø§Ù…Ù¾Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ
        $detection_prompt = "You are an AI assistant designed to detect if a customer review requires human intervention. Analyze the customer's comment and the AI-generated response below. Return ONLY 'YES' if human intervention is required, or 'NO' if it is not.
        Customer Comment:
        \"{$customer_comment}\"
        AI Generated Response:
        \"{$ai_response}\"
        Does this review require human intervention? (Answer ONLY 'YES' or 'NO')";
        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API
        $detection_response = $this->call_ai_api($detection_prompt);
        if (is_wp_error($detection_response)) {
            // Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯ØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
            return false;
        }
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®
        $detection_response = strtoupper(trim($detection_response));
        return $detection_response === 'YES';
    }
    private function create_task_for_manager($comment_id, $reason) {
        $tasks = get_option('_wc_ai_review_tasks', array());
        $tasks[] = array(
            'id' => uniqid(),
            'comment_id' => $comment_id,
            'reason' => $reason,
            'created_at' => current_time('mysql'),
            'status' => 'pending'
        );
        update_option('_wc_ai_review_tasks', $tasks);
        // Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ù‡ Ù…Ø¯ÛŒØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        $admin_email = get_option('admin_email');
        $subject = 'ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯: Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ';
        $message = "ÛŒÚ© Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯ (#{$comment_id}) Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ø¯.
Ø¯Ù„ÛŒÙ„: {$reason}
Ù„ÛŒÙ†Ú© Ù†Ø¸Ø±: " . get_comment_link($comment_id);
        wp_mail($admin_email, $subject, $message);
    }
    private function generate_ai_reply($comment_id) {
        $comment = get_comment($comment_id);
        if (!$comment) {
            return new WP_Error('invalid_comment', __('Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'wc-ai-review-reply-pro'));
        }
        if ($comment->comment_type !== 'review' && $comment->comment_type !== '') {
            return new WP_Error('invalid_comment_type', __('Ø§ÛŒÙ† Ù†ÙˆØ¹ Ù†Ø¸Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'wc-ai-review-reply-pro'));
        }
        $post_id = $comment->comment_post_ID;
        if (get_post_type($post_id) === 'product') {
            $product = wc_get_product($post_id);
            if (!$product) {
                return new WP_Error('invalid_product', __('Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'wc-ai-review-reply-pro'));
            }
            $product_info = array(
                'title' => $product->get_name(),
                'short_description' => $product->get_short_description(),
                'attributes' => $this->get_product_attributes($product),
                'description' => $this->trim_description($product->get_description())
            );
        } else {
            $post = get_post($post_id);
            if (!$post) {
                return new WP_Error('invalid_post', __('Ù…Ø·Ù„Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'wc-ai-review-reply-pro'));
            }
            $product_info = array(
                'title' => $post->post_title,
                'short_description' => wp_trim_words($post->post_excerpt, 20),
                'attributes' => '',
                'description' => $this->trim_description($post->post_content)
            );
        }
        if (empty($this->options['api_key'])) {
            return new WP_Error('api_not_configured', __('API Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª', 'wc-ai-review-reply-pro'));
        }
        // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡
        $forbidden_keywords = isset($this->options['forbidden_keywords']) ? $this->options['forbidden_keywords'] : '';
        if (!empty($forbidden_keywords)) {
            $keywords = explode(',', $forbidden_keywords);
            foreach ($keywords as $keyword) {
                $keyword = trim($keyword);
                if (!empty($keyword) && stripos($comment->comment_content, $keyword) !== false) {
                    // Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                    $forbidden_response = isset($this->options['forbidden_response']) ? $this->options['forbidden_response'] : 'Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø­Ø§ÙˆÛŒ Ø¨ÙˆØ¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ØŒ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ´Ø§Ø± Ù†ÛŒØ³Øª.';
                    return $forbidden_response;
                }
            }
        }
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡
        $canned_response = $this->check_for_canned_response($comment->comment_content);
        if ($canned_response) {
            $this->add_log($comment_id, 'canned_response_used', 'Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯');
            return $canned_response;
        }
        $previous_replies = array();
        if (isset($this->options['learn_from_previous']) && $this->options['learn_from_previous'] === '1') {
            $previous_replies = $this->get_previous_manager_replies($post_id);
        }
        $prompt = $this->build_prompt($product_info, $comment->comment_content, $previous_replies);
        $response = $this->call_ai_api($prompt);
        if (is_wp_error($response)) {
            $this->add_log($comment_id, 'api_error', 'Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API', $response->get_error_message());
            return $response;
        }
        // --- Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù†Ø·Ù‚ ØªØ´Ø®ÛŒØµ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ ---
        if ($this->requires_human_intervention_intelligent($comment->comment_content, $response)) {
            $reason = 'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯ Ú©Ù‡ Ø§ÛŒÙ† Ù†Ø¸Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ø¯.';
            $this->create_task_for_manager($comment_id, $reason);
            $this->add_log($comment_id, 'human_intervention_required', 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯', $reason);
            // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ø³ÙØ§Ø±Ø´ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            $custom_response = isset($this->options['human_intervention_response']) ? $this->options['human_intervention_response'] : 'Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ Ùˆ ØªÙˆØ³Ø· ØªÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² ØµØ¨Ø± Ùˆ Ù‡Ù…Ø±Ø§Ù‡ÛŒ Ø´Ù…Ø§.';
            return $custom_response;
        }
        $this->add_log($comment_id, 'reply_generated', 'Ù¾Ø§Ø³Ø® Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯', $response);
        return sanitize_text_field($response);
    }
    private function get_product_attributes($product) {
        $attributes = array();
        if ($product->is_type('variable')) {
            $variation_attributes = $product->get_variation_attributes();
            foreach ($variation_attributes as $attribute => $values) {
                $attributes[] = $attribute . ': ' . implode(', ', (array) $values);
            }
        }
        $product_attributes = $product->get_attributes();
        foreach ($product_attributes as $attribute) {
            if ($attribute->get_visible()) {
                $attributes[] = $attribute->get_name() . ': ' . implode(', ', $attribute->get_options());
            }
        }
        return implode(', ', $attributes);
    }
    private function trim_description($description, $max_length = 500) {
        $description = wp_strip_all_tags($description);
        if (mb_strlen($description) > $max_length) {
            $description = mb_substr($description, 0, $max_length) . '...';
        }
        return $description;
    }
    public function generate_ai_analysis_ajax() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²');
        }
        // Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ù…ÛŒ Ù†Ø¸Ø±Ø§Øª
        $comments = get_comments(array(
            'status' => 'approve',
            'type' => 'review',
            'number' => 50, // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…ØµØ±Ù Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ ØªÙˆÚ©Ù†
            'orderby' => 'comment_date',
            'order' => 'DESC'
        ));
        if (empty($comments)) {
            wp_send_json_error('Ù‡ÛŒÚ† Ù†Ø¸Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
        }
        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…ØªÙ† Ù†Ø¸Ø±Ø§Øª
        $all_comments_text = "Ù„ÛŒØ³Øª Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†:
";
        foreach ($comments as $comment) {
            $rating = get_comment_meta($comment->comment_ID, 'rating', true);
            $rating_text = $rating ? " (Ø§Ù…ØªÛŒØ§Ø²: {$rating} Ø§Ø² 5)" : "";
            $all_comments_text .= "Ù†Ø¸Ø± Ú©Ø§Ø±Ø¨Ø± (Ø´Ù†Ø§Ø³Ù‡: {$comment->comment_ID}){$rating_text}:
\"{$comment->comment_content}\"
---
";
        }
        // Ø³Ø§Ø®Øª Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„
        $prompt = "Ø´Ù…Ø§ ÛŒÚ© ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ù‡Ø³ØªÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø¸Ø±Ø§Øª Ø²ÛŒØ±ØŒ ÛŒÚ© Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ ØªÙ‡ÛŒÙ‡ Ú©Ù†ÛŒØ¯.
Ù…ØªÙ† Ù†Ø¸Ø±Ø§Øª:
{$all_comments_text}
Ù„Ø·ÙØ§Ù‹ Ú¯Ø²Ø§Ø±Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù‚Ø§Ù„Ø¨ HTML Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ø²ÛŒØ± Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯:
1. ÛŒÚ© Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ø¨Ø§ ØªÚ¯ <p> Ø¨Ù‡ Ù†Ø§Ù… 'Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ ØªØ­Ù„ÛŒÙ„ Ù†Ø¸Ø±Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†'
2. ÛŒÚ© Ø¨Ø®Ø´ 'Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ' Ú©Ù‡ Ø´Ø§Ù…Ù„ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù†Ø¸Ø±Ø§Øª Ø¨Ø§Ø´Ø¯.
3. ÛŒÚ© Ø¨Ø®Ø´ 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯' Ú©Ù‡ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ÛŒ Ú©Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ Ø®Ø±ÛŒØ¯ Ù…Ø¬Ø¯Ø¯ ÛŒØ§ ØªÙˆØµÛŒÙ‡ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø¯Ø§Ø±Ù†Ø¯ØŒ Ø°Ú©Ø± Ú©Ù†Ø¯ (Ø¨Ø§ Ø°Ú©Ø± Ø´Ù†Ø§Ø³Ù‡ Ù†Ø¸Ø± Ùˆ Ø¹Ø¨Ø§Ø±Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…Ø§Ù†Ù†Ø¯ 'Ø­ØªÙ…Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØ®Ø±Ù…' ÛŒØ§ 'Ø¨Ù‡ Ø¯ÙˆØ³ØªØ§Ù†Ù… Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù…').
4. ÛŒÚ© Ø¨Ø®Ø´ 'Ù†Ù‚Ø§Ø· Ù‚ÙˆØª' Ú©Ù‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ù…Ø²Ø§ÛŒØ§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø§Ø² Ù†Ø¸Ø± Ù…Ø´ØªØ±ÛŒØ§Ù† Ø±Ø§ Ù„ÛŒØ³Øª Ú©Ù†Ø¯.
5. ÛŒÚ© Ø¨Ø®Ø´ 'Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù' Ú©Ù‡ Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø§Ù†ØªÙ‚Ø§Ø¯Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù† Ø±Ø§ Ù„ÛŒØ³Øª Ú©Ù†Ø¯.
6. ÛŒÚ© Ø¨Ø®Ø´ 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª' Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø®Ø¯Ù…Ø§Øª.
7. Ø¯Ø± Ù¾Ø§ÛŒØ§Ù†ØŒ ÛŒÚ© Ù†Ù…ÙˆØ¯Ø§Ø± Ø³Ø§Ø¯Ù‡ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Chart.js Ú©Ù‡ ØªÙˆØ²ÛŒØ¹ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª (Ù…Ø«Ù„Ø§Ù‹ 5 Ø³ØªØ§Ø±Ù‡ØŒ 4 Ø³ØªØ§Ø±Ù‡ Ùˆ ...) Ø±Ø§ Ù†Ø´Ø§Ù† Ø¯Ù‡Ø¯. Ú©Ø¯ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ø§ Ø¯Ø± ÛŒÚ© div Ø¨Ø§ Ú©Ù„Ø§Ø³ 'chart-container' Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
8. ØªÙ…Ø§Ù…ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ø¨Ø§Ø´Ù†Ø¯.
9. Ø§Ø² ØªÚ¯â€ŒÙ‡Ø§ÛŒ <p>ØŒ <ul>ØŒ <li> Ùˆ <strong> Ø¨Ø±Ø§ÛŒ Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯. Ùˆ Ø§Ø² p p ... Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†
10 . Ø§Ø² Ø§Ø³ØªÛŒÚ©Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† Ùˆ ØªØ§ Ø¬Ø§ÛŒ Ù…Ù…Ú©Ù† ØªØ­Ù„ÛŒÙ„ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ùˆ Ú©Ø§Ù…Ù„ Ø¨Ø¯Ù‡
";
        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API
        $response = $this->call_ai_api($prompt);
        if (is_wp_error($response)) {
            wp_send_json_error($response->get_error_message());
        }
        // Ø§ÛŒØ¬Ø§Ø¯ HTML Ù†Ù‡Ø§ÛŒÛŒ
        $html = '
        <div class="analysis-report p-6 bg-white rounded-lg shadow">
            ' . $response . '
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
        jQuery(document).ready(function($) {
            // Ø±Ù†Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§
            if (typeof Chart !== "undefined") {
                $(".chart-container").each(function() {
                    var ctx = this.getContext("2d");
                    if (ctx) {
                        new Chart(ctx, {
                            type: "bar",
                             {
                                labels: ["5 Ø³ØªØ§Ø±Ù‡", "4 Ø³ØªØ§Ø±Ù‡", "3 Ø³ØªØ§Ø±Ù‡", "2 Ø³ØªØ§Ø±Ù‡", "1 Ø³ØªØ§Ø±Ù‡"],
                                datasets: [{
                                    label: "ØªÙˆØ²ÛŒØ¹ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª",
                                    data: [12, 8, 3, 2, 1],
                                    backgroundColor: [
                                        "rgba(54, 162, 235, 0.2)",
                                        "rgba(255, 206, 86, 0.2)",
                                        "rgba(75, 192, 192, 0.2)",
                                        "rgba(255, 159, 64, 0.2)",
                                        "rgba(255, 99, 132, 0.2)"
                                    ],
                                    borderColor: [
                                        "rgba(54, 162, 235, 1)",
                                        "rgba(255, 206, 86, 1)",
                                        "rgba(75, 192, 192, 1)",
                                        "rgba(255, 159, 64, 1)",
                                        "rgba(255, 99, 132, 1)"
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                });
            }
        });
        </script>
        ';
        wp_send_json_success(array('html' => $html));
    }
    public function download_analysis_pdf() {
        check_ajax_referer('wc_ai_review_nonce', 'nonce');
        if (!current_user_can('manage_options')) {
            wp_die('Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²');
        }
        $html = isset($_GET['html']) ? sanitize_text_field($_GET['html']) : '';
        if (empty($html)) {
            wp_die('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
        }
        // Ø³Ø§Ø¯Ù‡â€ŒØªØ±: Ø®Ø±ÙˆØ¬ÛŒ HTML
        header('Content-Type: text/html; charset=UTF-8');
        echo '<!DOCTYPE html><html dir="rtl"><head><meta charset="UTF-8"><title>Ú¯Ø²Ø§Ø±Ø´ ØªØ­Ù„ÛŒÙ„ Ù†Ø¸Ø±Ø§Øª</title></head><body>';
        echo $html;
        echo '</body></html>';
        exit;
    }
    private function get_previous_manager_replies($post_id, $limit = 4) {
        $replies = get_comments(array(
            'post_id' => $post_id,
            'status' => 'approve',
            'type' => 'comment',
            'parent__not_in' => array(0),
            'number' => $limit,
            'orderby' => 'comment_date',
            'order' => 'DESC'
        ));
        $manager_replies = array();
        foreach ($replies as $reply) {
            $user = get_user_by('id', $reply->user_id);
            if ($user && (in_array('administrator', $user->roles) || in_array('shop_manager', $user->roles) || $user->ID === $this->ai_user_id)) {
                $manager_replies[] = $reply->comment_content;
            }
        }
        return $manager_replies;
    }
    private function build_prompt($product_info, $customer_comment, $previous_replies) {
        // ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù† Ù†Ø¸Ø±
        $detected_lang = $this->detect_language($customer_comment);
        $supported_languages = isset($this->options['supported_languages']) ? explode(',', $this->options['supported_languages']) : array('fa', 'en');
        $default_language = isset($this->options['default_language']) ? $this->options['default_language'] : 'fa';
        // Ø§Ú¯Ø± Ø²Ø¨Ø§Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø§Ø² Ø²Ø¨Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
        if (!in_array($detected_lang, $supported_languages)) {
            $target_lang = $default_language;
        } else {
            $target_lang = $detected_lang;
        }
        // ØªØ±Ø¬Ù…Ù‡ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ø²Ø¨Ø§Ù†
        $language_instruction = '';
        switch ($target_lang) {
            case 'fa':
                $language_instruction = 'Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.';
                break;
            case 'en':
                $language_instruction = 'Please respond in English.';
                break;
            case 'ar':
                $language_instruction = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¯ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.';
                break;
            default:
                $language_instruction = 'Please respond in the same language as the customer.';
        }
        // ØªØ¹ÛŒÛŒÙ† Ù„Ø­Ù† Ù¾Ø§Ø³Ø® (Ù‡Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„)
        $tone_instruction = '';
        $tone = isset($this->options['tone']) ? $this->options['tone'] : 'professional';
        switch ($tone) {
            case 'professional':
                $tone_instruction = 'Please use a professional and formal tone.';
                break;
            case 'friendly':
                $tone_instruction = 'Please use a friendly and conversational tone.';
                break;
            case 'formal':
                $tone_instruction = 'Please use a very formal and respectful tone.';
                break;
            case 'casual':
                $tone_instruction = 'Please use a casual and informal tone.';
                break;
            case 'custom':
                $custom_tone = isset($this->options['custom_tone']) ? $this->options['custom_tone'] : '';
                $tone_instruction = $custom_tone;
                break;
            case 'learn':
                $tone_instruction = 'Please mimic the tone and style of the previous manager replies.';
                break;
        }
        $prompt = "You are a helpful support assistant for an online WooCommerce shop.
Your task is to reply to customer reviews in a helpful and engaging manner.
{$language_instruction}
{$tone_instruction}
Be concise (2-4 sentences), friendly, and professional.
If the customer complains, offer a practical solution or invite them to contact support.
Do not mention that you are an AI or any internal processes.
Product Info:
Title: {$product_info['title']}
Short Description: {$product_info['short_description']}
Key Features: {$product_info['attributes']}
Summary: {$product_info['description']}
Customer Review:
\"{$customer_comment}\"
Previous Manager Replies (examples):
";
        foreach ($previous_replies as $index => $reply) {
            $prompt .= "
\"{$reply}\"
";
        }
        $prompt .= "
Now, write a reply that matches the tone and style.";
        return $prompt;
    }
    private function call_ai_api($prompt) {
        $provider = isset($this->options['api_provider']) ? $this->options['api_provider'] : 'oneapi';
        $api_key = $this->options['api_key'];
        $model = isset($this->options['model']) ? $this->options['model'] : 'gpt-3.5-turbo';
        $temperature = isset($this->options['temperature']) ? floatval($this->options['temperature']) : 0.7;
        $max_tokens = isset($this->options['max_tokens']) ? intval($this->options['max_tokens']) : 500;
        switch ($provider) {
            case 'openai':
                $endpoint = isset($this->options['openai_url']) ? $this->options['openai_url'] : 'https://api.openai.com/v1/chat/completions';
                $headers = array(
                    'Content-Type' => 'application/json',
                    'Authorization' => 'Bearer ' . $api_key
                );
                break;
            case 'deepseek':
                $endpoint = isset($this->options['deepseek_url']) ? $this->options['deepseek_url'] : 'https://api.deepseek.com/v1/chat/completions';
                $headers = array(
                    'Content-Type' => 'application/json',
                    'Authorization' => 'Bearer ' . $api_key
                );
                break;
            case 'oneapi':
            default:
                $endpoint = isset($this->options['oneapi_url']) ? $this->options['oneapi_url'] : 'https://api.one-api.ir/openai/v1/chat/completions';
                $headers = array(
                    'Content-Type' => 'application/json',
                    'one-api-token' => $api_key
                );
                break;
        }
        $body = array(
            'model' => $model,
            'messages' => array(
                array(
                    'role' => 'system',
                    'content' => 'You are a helpful customer support representative for an online store.'
                ),
                array(
                    'role' => 'user',
                    'content' => $prompt
                )
            ),
            'temperature' => $temperature,
            'max_tokens' => $max_tokens
        );
        $response = wp_remote_post($endpoint, array(
            'headers' => $headers,
            'body' => json_encode($body),
            'timeout' => 30
        ));
        if (is_wp_error($response)) {
            return $response;
        }
        $response_code = wp_remote_retrieve_response_code($response);
        $response_body = json_decode(wp_remote_retrieve_body($response), true);
        if ($response_code !== 200) {
            return new WP_Error('api_error',
                __('Ø®Ø·Ø§ÛŒ API: ', 'wc-ai-review-reply-pro') .
                ($response_body['error']['message'] ?? __('Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡', 'wc-ai-review-reply-pro'))
            );
        }
        // Extract content based on provider
        if ($provider === 'oneapi') {
            $content = $response_body['result']['choices'][0]['message']['content'] ?? '';
        } else {
            $content = $response_body['choices'][0]['message']['content'] ?? '';
        }
        if (empty($content)) {
            return new WP_Error('invalid_response', __('Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² API', 'wc-ai-review-reply-pro'));
        }
        return $content;
    }
    public function canned_section_callback() {
        echo '<p class="text-sm text-gray-600">Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯.</p>';
    }
    public function keywords_section_callback() {
        echo '<p class="text-sm text-gray-600">Ú©Ù„Ù…Ø§ØªÛŒ Ú©Ù‡ Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ù†Ø¸Ø±ØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ù†Ø¯.</p>';
    }
    public function languages_section_callback() {
        echo '<p class="text-sm text-gray-600">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯.</p>';
    }
    public function canned_responses_render() {
        $value = isset($this->options['canned_responses']) ? $this->options['canned_responses'] : array();
        ?>
        <div id="canned-responses-container">
            <?php foreach ($value as $index => $item): ?>
                <div class="canned-response-item mb-4 p-4 border border-gray-200 rounded-md">
                    <input type="text" name="wc_ai_review_settings[canned_responses][<?php echo $index; ?>][trigger]" placeholder="Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ (Ù…Ø«Ù„Ø§Ù‹: Ù‡Ø²ÛŒÙ†Ù‡ Ø­Ù…Ù„)" value="<?php echo esc_attr($item['trigger'] ?? ''); ?>" class="block w-full mb-2 p-2 border border-gray-300 rounded-md" />
                    <textarea name="wc_ai_review_settings[canned_responses][<?php echo $index; ?>][response]" placeholder="Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡" rows="3" class="block w-full p-2 border border-gray-300 rounded-md"><?php echo esc_textarea($item['response'] ?? ''); ?></textarea>
                    <button type="button" class="remove-canned-response mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded-md">Ø­Ø°Ù</button>
                </div>
            <?php endforeach; ?>
        </div>
        <button type="button" id="add-canned-response" class="mt-2 px-4 py-2 bg-blue-500 text-white text-sm rounded-md">+ Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø§Ø³Ø® Ø¬Ø¯ÛŒØ¯</button>
        <p class="mt-2 text-xs text-gray-500">Ø§Ú¯Ø± Ù†Ø¸Ø± Ú©Ø§Ø±Ø¨Ø± Ø­Ø§ÙˆÛŒ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        <script>
            jQuery(document).ready(function($) {
                $('#add-canned-response').on('click', function() {
                    var index = $('#canned-responses-container .canned-response-item').length;
                    var html = `
                    <div class="canned-response-item mb-4 p-4 border border-gray-200 rounded-md">
                        <input type="text" name="wc_ai_review_settings[canned_responses][`+index+`][trigger]" placeholder="Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ (Ù…Ø«Ù„Ø§Ù‹: Ù‡Ø²ÛŒÙ†Ù‡ Ø­Ù…Ù„)" class="block w-full mb-2 p-2 border border-gray-300 rounded-md" />
                        <textarea name="wc_ai_review_settings[canned_responses][`+index+`][response]" placeholder="Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾ÛŒØ´ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡" rows="3" class="block w-full p-2 border border-gray-300 rounded-md"></textarea>
                        <button type="button" class="remove-canned-response mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded-md">Ø­Ø°Ù</button>
                    </div>
                `;
                    $('#canned-responses-container').append(html);
                });
                $(document).on('click', '.remove-canned-response', function() {
                    $(this).closest('.canned-response-item').remove();
                });
            });
        </script>
        <?php
    }
    private function detect_language($text) {
        // ÛŒÚ© Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ/Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
        $persian_chars = preg_match('/[\x{0600}-\x{06FF}\x{FB8A}\x{067E}\x{0686}\x{06AF}]/u', $text);
        $english_chars = preg_match('/[a-zA-Z]/', $text);
        if ($persian_chars && !$english_chars) {
            return 'fa';
        } elseif ($english_chars && !$persian_chars) {
            return 'en';
        } elseif ($persian_chars && $english_chars) {
            // Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ø·ÙˆÙ„ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            $persian_length = preg_match_all('/[\x{0600}-\x{06FF}\x{FB8A}\x{067E}\x{0686}\x{06AF}]/u', $text, $matches);
            if ($persian_length > 10) { // Ø§Ú¯Ø± Ø¨ÛŒØ´ Ø§Ø² 10 Ú©Ø§Ø±Ø§Ú©ØªØ± ÙØ§Ø±Ø³ÛŒ Ø¯Ø§Ø´Øª
                return 'fa';
            } else {
                return 'en';
            }
        }
        return 'en'; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    }
    public function analysis_page() {
        ?>
        <div class="wrap" dir="rtl">
            <p class="wp-heading-inline">ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø¸Ø±Ø§Øª</p>
            <hr class="wp-header-end">
            <div class="notice notice-warning">
                <p><strong>âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ù…ØµØ±Ù ØªÙˆÚ©Ù†:</strong> ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø¸Ø±Ø§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ÛŒ ØªÙˆÚ©Ù† Ù…ØµØ±Ù Ú©Ù†Ø¯. Ù„Ø·ÙØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø¬Ø±Ø§ØŒ Ø§Ø² Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ API Ø®ÙˆØ¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯.</p>
            </div>
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="card-body">
                    <button type="button" id="start-analysis" class="px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯
                    </button>
                    <span id="analysis-status" class="spinner ml-3" style="display: none;"></span>
                </div>
            </div>
            <div id="analysis-results" style="display: none;" class="bg-white shadow rounded-lg p-6">
                <p class="text-lg font-semibold mb-4 text-gray-700">Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„</p>
                <div id="analysis-content"></div>
                <div class="mt-6">
                    <button type="button" id="download-analysis-pdf" class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ ØµÙˆØ±Øª PDF
                    </button>
                </div>
            </div>
        </div>
        <script>
            jQuery(document).ready(function($) {
                $('#start-analysis').on('click', function() {
                    if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù‡Ø²ÛŒÙ†Ù‡ API Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.')) {
                        return;
                    }
                    var $button = $(this);
                    var $status = $('#analysis-status');
                    var $results = $('#analysis-results');
                    var $content = $('#analysis-content');
                    $button.prop('disabled', true);
                    $status.show();
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'generate_ai_analysis',
                            nonce: '<?php echo wp_create_nonce('wc_ai_review_nonce'); ?>'
                        },
                        success: function(response) {
                            if (response.success) {
                                $content.html(response.data.html);
                                $results.show();
                            } else {
                                alert('Ø®Ø·Ø§: ' + response.data);
                            }
                        },
                        error: function() {
                            alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                        },
                        complete: function() {
                            $button.prop('disabled', false);
                            $status.hide();
                        }
                    });
                });
                $(document).on('click', '#download-analysis-pdf', function() {
                    var analysisHtml = $('#analysis-content').html();
                    window.open('<?php echo admin_url('admin-ajax.php'); ?>?action=download_analysis_pdf&html=' + encodeURIComponent(analysisHtml) + '&nonce=<?php echo wp_create_nonce('wc_ai_review_nonce'); ?>', '_blank');
                });
            });
        </script>
        <?php
    }
    public function forbidden_keywords_render() {
        $value = isset($this->options['forbidden_keywords']) ? $this->options['forbidden_keywords'] : '';
        ?>
        <textarea name="wc_ai_review_settings[forbidden_keywords]" rows="4" class="block w-full p-2 border border-gray-300 rounded-md" placeholder="Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡ Ø±Ø§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯&#10;Ù…Ø«Ù„Ø§Ù‹: Ú©Ù„Ù…Ù‡Ø¨Ø¯, Ú©Ù„Ù…Ù‡Ù†Ø§Ù…Ù†Ø§Ø³Ø¨"><?php echo esc_textarea($value); ?></textarea>
        <p class="mt-2 text-xs text-gray-500">Ø§Ú¯Ø± Ù†Ø¸Ø± Ø­Ø§ÙˆÛŒ Ø§ÛŒÙ† Ú©Ù„Ù…Ø§Øª Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ù‡ Ø¬Ø§ÛŒ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ ÛŒÚ© Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ùˆ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        <?php
    }
    public function supported_languages_render() {
        $value = isset($this->options['supported_languages']) ? $this->options['supported_languages'] : 'fa,en';
        ?>
        <input type="text" name="wc_ai_review_settings[supported_languages]" value="<?php echo esc_attr($value); ?>" class="block w-full p-2 border border-gray-300 rounded-md" placeholder="fa,en,ar,..." />
        <p class="mt-2 text-xs text-gray-500">Ú©Ø¯Ù‡Ø§ÛŒ Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: fa, en, ar).</p>
        <?php
    }
    public function default_language_render() {
        $value = isset($this->options['default_language']) ? $this->options['default_language'] : 'fa';
        ?>
        <input type="text" name="wc_ai_review_settings[default_language]" value="<?php echo esc_attr($value); ?>" class="block w-full p-2 border border-gray-300 rounded-md" placeholder="fa" />
        <p class="mt-2 text-xs text-gray-500">Ú©Ø¯ Ø²Ø¨Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø³Ø§ÛŒØª (Ù…Ø«Ù„Ø§Ù‹: fa Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ).</p>
        <?php
    }
    private function post_reply($comment_id, $reply_content) {
        $comment = get_comment($comment_id);
        $reply_user = isset($this->options['reply_user']) ? $this->options['reply_user'] : 'ai';
        if ($reply_user === 'ai') {
            $user_id = $this->ai_user_id;
            $author_name = 'ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ';
            $author_email = 'ai-assistant@' . wp_parse_url(get_site_url(), PHP_URL_HOST);
        } else {
            $user = get_user_by('id', $reply_user);
            if ($user) {
                $user_id = $user->ID;
                $author_name = $user->display_name;
                $author_email = $user->user_email;
            } else {
                $user_id = $this->ai_user_id;
                $author_name = 'ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ';
                $author_email = 'ai-assistant@' . wp_parse_url(get_site_url(), PHP_URL_HOST);
            }
        }
        $reply_data = array(
            'comment_post_ID' => $comment->comment_post_ID,
            'comment_author' => $author_name,
            'comment_author_email' => $author_email,
            'comment_content' => $reply_content,
            'comment_parent' => $comment_id,
            'comment_type' => 'comment',
            'user_id' => $user_id,
            'comment_approved' => 1
        );
        $result = wp_insert_comment($reply_data);
        if ($result) {
            $this->add_log($comment_id, 'reply_posted', 'Ù¾Ø§Ø³Ø® Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', $reply_content);
            // ØªÙ†Ø¸ÛŒÙ… ÛŒÚ© transient Ø¨Ù„Ù†Ø¯Ù…Ø¯Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù¾Ø§Ø³Ø® ØªÚ©Ø±Ø§Ø±ÛŒ Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡
            // Ø§ÛŒÙ† transient ØªØ§ 30 Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ Ú©Ù‡ Ú©Ø§Ù…Ù„Ø§Ù‹ Ú©Ø§ÙÛŒ Ø§Ø³Øª.
            set_transient($this->transient_prefix . $comment_id, true, 30 * DAY_IN_SECONDS);
        } else {
            $this->add_log($comment_id, 'reply_failed', 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù¾Ø§Ø³Ø®');
        }
        return $result;
    }
    // Ø­Ø°Ù Ø§Ú©Ø´Ù† Ø§Ø² Ù„ÛŒØ³Øª Ù†Ø¸Ø±Ø§Øª
    // public function add_ai_reply_action($actions, $comment) {
    //     // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø±Ø§Øª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ùˆ Ù†ÙˆØ¹ review
    //     if ($comment->comment_type === 'review' && $comment->comment_approved === '1') {
    //         $actions['generate_ai_reply'] = sprintf(
    //             '<a href="#" class="generate-ai-reply text-indigo-600 hover:text-indigo-900 inline-block" data-comment-id="%d">%s</a>',
    //             $comment->comment_ID,
    //             __('Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯', 'wc-ai-review-reply-pro')
    //         );
    //         $actions['toggle_exception'] = sprintf(
    //             '<a href="#" class="toggle-exception text-amber-600 hover:text-amber-900 inline-block" data-comment-id="%d">%s</a>',
    //             $comment->comment_ID,
    //             __('Ø­Ø°Ù/Ø§Ø¶Ø§ÙÙ‡ Ø§Ø² Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§', 'wc-ai-review-reply-pro')
    //         );
    //     }
    //     return $actions;
    // }
    public function add_comment_meta_box() {
        add_meta_box(
            'wc_ai_review_meta_box',
            __('Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯', 'wc-ai-review-reply-pro'),
            array($this, 'comment_meta_box_content'),
            'comment',
            'normal',
            'high'
        );
    }
    public function comment_meta_box_content($comment) {
        if ($comment->comment_type !== 'review' || $comment->comment_approved !== '1') {
            echo '<p class="text-gray-500">Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø±Ø§Øª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª.</p>';
            return;
        }
        echo '<div id="wc-ai-review-metabox" class="space-y-4">';
        echo '<button type="button" class="generate-ai-reply px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-comment-id="' . $comment->comment_ID . '">ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯</button>';
        echo '<button type="button" class="toggle-exception px-4 py-2 bg-amber-600 text-white text-sm font-medium rounded-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500" data-comment-id="' . $comment->comment_ID . '">Ø­Ø°Ù/Ø§Ø¶Ø§ÙÙ‡ Ø§Ø² Ø§Ø³ØªØ«Ù†Ø§Ù‡Ø§</button>';
        echo '<div id="ai-reply-preview" style="display: none; margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 4px;"></div>';
        echo '</div>';
    }
    public function show_admin_notices() {
        if (empty($this->options['api_key'])) {
            echo '<div class="notice notice-warning"><p>' .
                __('Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ù„Ø§Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ú©Ù„ÛŒØ¯ API Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'wc-ai-review-reply-pro') .
                ' <a href="' . admin_url('admin.php?page=wc-ai-review-settings') . '">' .
                __('Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'wc-ai-review-reply-pro') . '</a></p></div>';
        }
        if ($this->ai_user_id === 0 || !get_user_by('id', $this->ai_user_id)) {
            echo '<div class="notice notice-error"><p>' .
                __('Ú©Ø§Ø±Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ù¾Ù„Ø§Ú¯ÛŒÙ† Ø±Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ùˆ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.', 'wc-ai-review-reply-pro') .
                '</p></div>';
        }
    }
    public function add_post_meta_boxes() {
        add_meta_box(
            'wc_ai_review_exclude_meta_box',
            __('Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø¸Ø±Ø§Øª', 'wc-ai-review-reply-pro'),
            array($this, 'post_meta_box_content'),
            array('post', 'product'),
            'side',
            'default'
        );
    }
    public function tasks_page() {
        ?>
        <div class="wrap" dir="rtl">
            <p class="wp-heading-inline">Ù„ÛŒØ³Øª ÙˆØ¸Ø§ÛŒÙ Ø¨Ø§Ø²</p>
            <hr class="wp-header-end">
            <div class="bg-white shadow rounded-lg overflow-hidden mt-6">
                <?php
                $tasks = get_option('_wc_ai_review_tasks', array());
                $tasks = array_filter($tasks, function($task) {
                    return $task['status'] === 'pending';
                });
                ?>
                <?php if (empty($tasks)): ?>
                    <div class="p-8 text-center text-gray-500">
                        Ù‡ÛŒÚ† ÙˆØ¸ÛŒÙÙ‡ Ø¨Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.
                    </div>
                <?php else: ?>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø´Ù†Ø§Ø³Ù‡ Ù†Ø¸Ø±</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¯Ù„ÛŒÙ„</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                        <?php foreach ($tasks as $task): ?>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <a href="<?php echo get_comment_link($task['comment_id']); ?>" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                        #<?php echo $task['comment_id']; ?>
                                    </a>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    <?php echo esc_html($task['reason']); ?>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <?php echo date('Y-m-d H:i', strtotime($task['created_at'])); ?>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button type="button" class="complete-task px-3 py-1 bg-green-600 text-white text-xs rounded-md" data-task-id="<?php echo esc_attr($task['id']); ?>">
                                        ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯
                                    </button>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                <?php endif; ?>
            </div>
        </div>
        <script>
            jQuery(document).ready(function($) {
                $('.complete-task').on('click', function() {
                    var taskId = $(this).data('task-id');
                    var $row = $(this).closest('tr');
                    $.ajax({
                        url: '<?php echo admin_url('admin-ajax.php'); ?>',
                        type: 'POST',
                        data: {
                            action: 'complete_ai_task',
                            task_id: taskId,
                            nonce: '<?php echo wp_create_nonce('wc_ai_review_nonce'); ?>'
                        },
                        success: function(response) {
                            if (response.success) {
                                $row.fadeOut();
                            } else {
                                alert('Ø®Ø·Ø§: ' + response.data);
                            }
                        }
                    });
                });
            });
        </script>
        <?php
    }
    public function interested_users_page() {
        // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù…ÛŒ Ù†Ø¸Ø±Ø§Øª
        $comments = get_comments(array(
            'status' => 'approve',
            'type' => 'review',
            'number' => 6,
            'orderby' => 'comment_date',
            'order' => 'DESC'
        ));
        ?>
        <div class="wrap" dir="rtl">
            <div class="bg-white shadow rounded-lg overflow-hidden mt-6">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                    <tr>
                        <th width="5%" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù†Ø¸Ø± Ù…Ø´ØªØ±ÛŒ</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                    <?php if (empty($comments)): ?>
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500">Ù‡ÛŒÚ† Ù†Ø¸Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>
                        </tr>
                    <?php else: ?>
                        <?php foreach ($comments as $index => $comment): ?>
                            <?php
                            $user = get_user_by('email', $comment->comment_author_email);
                            $post = get_post($comment->comment_post_ID);
                            ?>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo $index + 1; ?></td>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    <strong>Ù†Ø§Ù…:</strong> <?php echo esc_html($comment->comment_author); ?><br>
                                    <strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> <?php echo esc_html($comment->comment_author_email); ?><br>
                                    <?php if ($user): ?>
                                        <strong>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> <?php echo esc_html($user->user_login); ?><br>
                                        <strong>Ù†Ù‚Ø´:</strong> <?php echo implode(', ', $user->roles); ?>
                                    <?php endif; ?>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    <?php if ($post): ?>
                                        <strong>Ø¹Ù†ÙˆØ§Ù†:</strong> <a href="<?php echo get_permalink($post->ID); ?>" target="_blank" class="text-indigo-600 hover:text-indigo-900"><?php echo esc_html($post->post_title); ?></a><br>
                                        <strong>Ù†ÙˆØ¹:</strong> <?php echo esc_html($post->post_type); ?><br>
                                        <strong>ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ´Ø§Ø±:</strong> <?php echo date('Y-m-d', strtotime($post->post_date)); ?>
                                    <?php else: ?>
                                        <em class="text-gray-500">Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯</em>
                                    <?php endif; ?>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    <div style="max-width: 400px; word-wrap: break-word;">
                                        <?php echo wpautop(esc_html($comment->comment_content)); ?>
                                    </div>
                                    <small class="text-gray-500">ØªØ§Ø±ÛŒØ® Ù†Ø¸Ø±: <?php echo date('Y-m-d H:i', strtotime($comment->comment_date)); ?></small>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <div class="space-y-2">
                                        <button type="button" class="generate-ai-reply px-3 py-1 bg-indigo-600 text-white text-xs rounded-md" data-comment-id="<?php echo $comment->comment_ID; ?>">
                                            ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯
                                        </button>
                                        <div class="flex items-center space-x-2 space-x-reverse">
                                            <input type="datetime-local" class="scheduled-time px-2 py-1 text-xs border border-gray-300 rounded-md" data-comment-id="<?php echo $comment->comment_ID; ?>" />
                                            <button type="button" class="schedule-reply px-2 py-1 bg-yellow-600 text-white text-xs rounded-md" data-comment-id="<?php echo $comment->comment_ID; ?>">
                                                Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ
                                            </button>
                                        </div>
                                        <div id="ai-reply-container-<?php echo $comment->comment_ID; ?>" class="mt-3" style="display: none;">
                                            <div class="p-3 bg-green-50 border border-green-200 rounded-md text-sm">
                                                <strong>Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong>
                                                <div id="ai-reply-<?php echo $comment->comment_ID; ?>" class="mt-2"></div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                    <?php endif; ?>
                    </tbody>
                </table>
            </div>
            <!-- Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ -->
            <div class="bg-white shadow rounded-lg p-6 mt-8">
                <p class="text-lg font-semibold mb-4 text-gray-700">Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</p>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø´Ù†Ø§Ø³Ù‡ Ù†Ø¸Ø±</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø²Ù…Ø§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ÙˆØ¶Ø¹ÛŒØª</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                        <?php
                        $scheduled_replies = get_option('_wc_ai_review_scheduled_replies', array());
                        if (empty($scheduled_replies)):
                            ?>
                            <tr>
                                <td colspan="4" class="px-6 py-4 text-center text-gray-500">Ù‡ÛŒÚ† Ù¾Ø§Ø³Ø® Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</td>
                            </tr>
                        <?php else: ?>
                            <?php foreach ($scheduled_replies as $reply): ?>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        #<?php echo $reply['comment_id']; ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        <?php echo date('Y-m-d H:i', strtotime($reply['scheduled_time'])); ?>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                                Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø±Ø³Ø§Ù„
                                            </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button type="button" class="cancel-scheduled-reply px-2 py-1 bg-red-600 text-white text-xs rounded-md" data-comment-id="<?php echo $reply['comment_id']; ?>">
                                            Ù„ØºÙˆ
                                        </button>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <script>
            jQuery(document).ready(function($) {
                // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯
                $('.generate-ai-reply').on('click', function() {
                    var $button = $(this);
                    var commentId = $button.data('comment-id');
                    var $container = $('#ai-reply-container-' + commentId);
                    var $replyDiv = $('#ai-reply-' + commentId);
                    $button.prop('disabled', true).text('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...');
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'generate_ai_reply',
                            comment_id: commentId,
                            nonce: wc_ai_review.nonce
                        },
                        success: function(response) {
                            if (response.success) {
                                $replyDiv.html(response.data.reply);
                                $container.slideDown();
                            } else {
                                alert('Ø®Ø·Ø§: ' + response.data);
                                $button.prop('disabled', false).text('ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯');
                            }
                        },
                        error: function() {
                            alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
                            $button.prop('disabled', false).text('ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯');
                        }
                    });
                });
            });
        </script>
        <?php
    }
    public function post_meta_box_content($post) {
        $excluded = get_post_meta($post->ID, '_wc_ai_review_excluded', true);
        wp_nonce_field('wc_ai_review_exclude_nonce', 'wc_ai_review_exclude_nonce');
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_excluded" value="1" <?php checked($excluded, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2 text-sm"><?php _e('ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø·Ù„Ø¨', 'wc-ai-review-reply-pro'); ?></span>
        </label>
        <p class="mt-2 text-xs text-gray-500"><?php _e('Ø§Ú¯Ø± Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø±Ø§Øª Ø§ÛŒÙ† Ù…Ø·Ù„Ø¨ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªÙˆÙ„ÛŒØ¯ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.', 'wc-ai-review-reply-pro'); ?></p>
        <?php
    }
    public function save_post_meta($post_id, $post, $update) {
        if (!current_user_can('edit_post', $post_id) || !isset($_POST['wc_ai_review_exclude_nonce']) ||
            !wp_verify_nonce($_POST['wc_ai_review_exclude_nonce'], 'wc_ai_review_exclude_nonce')) {
            return;
        }
        if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {
            return;
        }
        $excluded = isset($_POST['wc_ai_review_excluded']) ? '1' : '0';
        update_post_meta($post_id, '_wc_ai_review_excluded', $excluded);
    }
    public function show_human_intervention_alert() {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ ÙØ¹Ø§Ù„ Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
        if (!isset($this->options['enable_human_intervention_alerts']) || $this->options['enable_human_intervention_alerts'] !== '1') {
            return;
        }
        // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ÙˆØ¸Ø§ÛŒÙ Ø¨Ø§Ø² (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ)
        $tasks = get_option('_wc_ai_review_tasks', array());
        $tasks = array_filter($tasks, function($task) {
            return $task['status'] === 'pending';
        });
        if (empty($tasks)) {
            return; // Ù‡ÛŒÚ† ÙˆØ¸ÛŒÙÙ‡ Ø¨Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
        }
        // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø´Ø¯Ø§Ø±
        echo '<div class="notice notice-warning is-dismissible">';
        echo '<p><strong>âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ:</strong> ' . count($tasks) . ' Ù†Ø¸Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ø¯. <a href="' . admin_url('admin.php?page=wc-ai-review-reply') . '">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¸Ø§ÛŒÙ</a></p>';
        echo '</div>';
    }
    public function notifications_section_callback() {
        echo '<p class="text-sm text-gray-600">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ Ùˆ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ.</p>';
    }
    public function enable_human_intervention_alerts_render() {
        $value = isset($this->options['enable_human_intervention_alerts']) ? $this->options['enable_human_intervention_alerts'] : '0';
        ?>
        <label class="inline-flex items-center">
            <input type="checkbox" name="wc_ai_review_settings[enable_human_intervention_alerts]" value="1" <?php checked($value, '1'); ?> class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            <span class="mr-2 text-sm">ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ø´Ø¯Ø§Ø± Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
        </label>
        <p class="mt-2 text-xs text-gray-500">Ø§Ú¯Ø± Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ØŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ø¸Ø±Ø§ØªÛŒ Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ù†Ø¯ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù‡Ø´Ø¯Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
        <?php
    }
    public function human_intervention_response_render() {
        $value = isset($this->options['human_intervention_response']) ? $this->options['human_intervention_response'] : 'Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ Ùˆ ØªÙˆØ³Ø· ØªÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² ØµØ¨Ø± Ùˆ Ù‡Ù…Ø±Ø§Ù‡ÛŒ Ø´Ù…Ø§.';
        ?>
        <textarea name="wc_ai_review_settings[human_intervention_response]" rows="4" class="block w-full p-2 border border-gray-300 rounded-md" placeholder="Ù¾Ø§Ø³Ø® Ø³ÙØ§Ø±Ø´ÛŒ Ù‡Ù†Ú¯Ø§Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ"><?php echo esc_textarea($value); ?></textarea>
        <p class="mt-2 text-xs text-gray-500">Ø§ÛŒÙ† Ù¾Ø§Ø³Ø® Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ù‡Ø¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø¯Ø§Ø®Ù„Ù‡ Ø§Ù†Ø³Ø§Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.</p>
        <?php
    }
}
new WC_AI_Review_Reply_Pro();
// Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CSS Ùˆ JS Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ
register_activation_hook(__FILE__, 'wc_ai_review_reply_pro_activate');
function wc_ai_review_reply_pro_activate() {

}

